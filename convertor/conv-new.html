<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø¨Ø¯Ù„ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Quiz.json</title>
    <style>
        body { font-family: Tahoma; direction: rtl; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #2c3e50; text-align: center; margin-bottom: 30px; }
        .upload-section { margin: 20px 0; padding: 20px; background: #e8f4fd; border-radius: 8px; }
        .file-input { margin: 10px 0; padding: 10px; border: 2px dashed #3498db; border-radius: 5px; background: white; }
        button { background: #27ae60; color: white; border: none; padding: 12px 24px; border-radius: 5px; cursor: pointer; font-size: 16px; margin: 10px 5px; }
        button:hover { background: #219a52; }
        .preview { margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 5px; border: 1px solid #ddd; }
        .stats { background: #fff3cd; padding: 15px; border-radius: 5px; margin: 15px 0; }
        .question-sample { background: white; padding: 15px; margin: 10px 0; border-radius: 5px; border-right: 4px solid #3498db; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“ Ù…Ø¨Ø¯Ù„ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Quiz.json Ø¨Ø±Ø§ÛŒ Ø¢Ù…ÙˆØ²Ø´ Ø²Ø¨Ø§Ù† Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ</h1>
        
        <div class="upload-section">
            <h3>ğŸ“ Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…Ù†Ø¨Ø¹:</h3>
            <div class="file-input">
                <label>ÙØ§ÛŒÙ„ ÙˆØ§Ú˜Ú¯Ø§Ù† (vocab.json):</label>
                <input type="file" id="vocabFile" accept=".json">
            </div>
            <div class="file-input">
                <label>ÙØ§ÛŒÙ„ Ú¯Ø±Ø§Ù…Ø± (grammar.json):</label>
                <input type="file" id="grammarFile" accept=".json">
            </div>
            <div class="file-input">
                <label>ÙØ§ÛŒÙ„ Ù…Ú©Ø§Ù„Ù…Ù‡ (conversation.json):</label>
                <input type="file" id="conversationFile" accept=".json">
            </div>
            
            <button onclick="processFiles()">ğŸ”„ ØªÙˆÙ„ÛŒØ¯ Quiz.json</button>
            <button onclick="downloadQuiz()" id="downloadBtn" style="display:none; background:#3498db;">ğŸ“¥ Ø¯Ø§Ù†Ù„ÙˆØ¯ Quiz.json</button>
        </div>

        <div id="stats" class="stats" style="display:none;"></div>
        <div id="preview" class="preview" style="display:none;"></div>
    </div>

    <script>
        let generatedQuiz = null;

        function processFiles() {
            const files = {
                vocab: document.getElementById('vocabFile').files[0],
                grammar: document.getElementById('grammarFile').files[0],
                conversation: document.getElementById('conversationFile').files[0]
            };

            // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§
            if (!files.vocab || !files.grammar || !files.conversation) {
                alert('Ù„Ø·ÙØ§Ù‹ Ù‡Ù…Ù‡ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø±Ø§ Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†ÛŒØ¯');
                return;
            }

            Promise.all([
                readFile(files.vocab),
                readFile(files.grammar),
                readFile(files.conversation)
            ]).then(([vocabData, grammarData, conversationData]) => {
                generatedQuiz = createRichQuiz(vocabData, grammarData, conversationData);
                showPreview(generatedQuiz);
                document.getElementById('downloadBtn').style.display = 'inline-block';
            }).catch(error => {
                alert('Ø®Ø·Ø§ Ø¯Ø± Ù¾Ø±Ø¯Ø§Ø²Ø´ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§: ' + error.message);
            });
        }

        function readFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = e => resolve(JSON.parse(e.target.result));
                reader.onerror = reject;
                reader.readAsText(file);
            });
        }

        function createRichQuiz(vocab, grammar, conversation) {
            const quiz = {
                metadata: {
                    title: "Ø¢Ø²Ù…ÙˆÙ† Ø¬Ø§Ù…Ø¹ Ø²Ø¨Ø§Ù† Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ",
                    description: "Ø¢Ø²Ù…ÙˆÙ† ØªÙˆÙ„ÛŒØ¯ Ø´Ø¯Ù‡ Ø§Ø² Ù…Ø­ØªÙˆØ§ÛŒ Ø¢Ù…ÙˆØ²Ø´ÛŒ",
                    level: "Intermediate",
                    totalQuestions: 0,
                    estimatedTime: "45 minutes",
                    generatedAt: new Date().toISOString(),
                    source: "Professional Quiz Generator"
                },
                vocabulary: generateVocabularyQuestions(vocab),
                grammar: generateGrammarQuestions(grammar),
                conversation: generateConversationQuestions(conversation),
                mixed: generateMixedQuestions(vocab, grammar, conversation)
            };

            // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¢Ù…Ø§Ø±
            quiz.metadata.totalQuestions = 
                quiz.vocabulary.length + 
                quiz.grammar.length + 
                quiz.conversation.length + 
                quiz.mixed.length;

            return quiz;
        }

        function generateVocabularyQuestions(vocab) {
            const questions = [];
            
            if (vocab.vocabulary) {
                vocab.vocabulary.forEach((word, index) => {
                    // Ø³ÙˆØ§Ù„ ØªØ¹Ø±ÛŒÙ (Definition)
                    questions.push({
                        id: `vocab_def_${index}`,
                        type: "multiple_choice",
                        category: "vocabulary",
                        subcategory: "definition",
                        difficulty: "easy",
                        question: `Ù…Ø¹Ù†ÛŒ Ú©Ù„Ù…Ù‡ "${word.word}" Ú†ÛŒØ³ØªØŸ`,
                        options: generateWrongDefinitions(word.meaning, vocab.vocabulary),
                        correctAnswer: word.meaning,
                        explanation: `ØªÙ„ÙØ¸: ${word.pronunciation || '---'} | Ù…Ø«Ø§Ù„: ${word.example || '---'}`,
                        tags: ["ÙˆØ§Ú˜Ú¯Ø§Ù†", "Ù…Ø¹Ù†ÛŒ"]
                    });

                    // Ø³ÙˆØ§Ù„ Ù…Ø«Ø§Ù„ (Example Completion)
                    if (word.example) {
                        const blankExample = word.example.replace(word.word, '______');
                        questions.push({
                            id: `vocab_ex_${index}`,
                            type: "fill_blank",
                            category: "vocabulary", 
                            subcategory: "usage",
                            difficulty: "medium",
                            question: `Ø¬Ø§ÛŒ Ø®Ø§Ù„ÛŒ Ø±Ø§ Ø¨Ø§ Ú©Ù„Ù…Ù‡ Ù…Ù†Ø§Ø³Ø¨ Ù¾Ø± Ú©Ù†ÛŒØ¯:\n"${blankExample}"`,
                            correctAnswer: word.word,
                            explanation: `Ù…Ø¹Ù†ÛŒ: ${word.meaning}`,
                            tags: ["Ú©Ø§Ø±Ø¨Ø±Ø¯", "Ø¬Ù…Ù„Ù‡â€ŒØ³Ø§Ø²ÛŒ"]
                        });
                    }

                    // Ø³ÙˆØ§Ù„ Ù…ØªØ±Ø§Ø¯Ù/Ù…ØªØ¶Ø§Ø¯
                    if (index % 3 === 0) { // Ù‡Ø± Ø³Ù‡ Ú©Ù„Ù…Ù‡ ÛŒÚ©Ø¨Ø§Ø±
                        questions.push({
                            id: `vocab_syn_${index}`,
                            type: "multiple_choice",
                            category: "vocabulary",
                            subcategory: "synonyms",
                            difficulty: "hard",
                            question: `Ù…ØªØ±Ø§Ø¯Ù Ú©Ù„Ù…Ù‡ "${word.word}" Ú©Ø¯Ø§Ù… Ø§Ø³ØªØŸ`,
                            options: generateSynonymsAntonyms(word.meaning, vocab.vocabulary, true),
                            correctAnswer: findSynonym(word.meaning, vocab.vocabulary),
                            explanation: `Ú©Ù„Ù…Ù‡ Ø§ØµÙ„ÛŒ: ${word.word} - Ù…Ø¹Ù†ÛŒ: ${word.meaning}`,
                            tags: ["Ù…ØªØ±Ø§Ø¯Ù", "ÙˆØ§Ú˜Ú¯Ø§Ù† Ù¾ÛŒØ´Ø±ÙØªÙ‡"]
                        });
                    }
                });
            }

            return questions;
        }

        function generateGrammarQuestions(grammar) {
            const questions = [];
            
            if (grammar.rules) {
                grammar.rules.forEach((rule, index) => {
                    // Ø³ÙˆØ§Ù„ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ù‚Ø§Ø¹Ø¯Ù‡
                    questions.push({
                        id: `grammar_rule_${index}`,
                        type: "multiple_choice",
                        category: "grammar",
                        subcategory: "rule_identification",
                        difficulty: "medium",
                        question: `Ú©Ø¯Ø§Ù… Ú¯Ø²ÛŒÙ†Ù‡ Ù†Ù…ÙˆÙ†Ù‡â€ŒØ§ÛŒ Ø§Ø² "${rule.name}" Ø§Ø³ØªØŸ`,
                        options: generateGrammarExamples(rule, grammar.rules),
                        correctAnswer: rule.examples[0],
                        explanation: `Ù‚Ø§Ø¹Ø¯Ù‡: ${rule.description}`,
                        tags: ["Ú¯Ø±Ø§Ù…Ø±", "Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ"]
                    });

                    // Ø³ÙˆØ§Ù„ ØªØµØ­ÛŒØ­ Ø®Ø·Ø§
                    if (rule.common_mistakes && rule.common_mistakes.length > 0) {
                        questions.push({
                            id: `grammar_correct_${index}`,
                            type: "multiple_choice",
                            category: "grammar",
                            subcategory: "error_correction", 
                            difficulty: "hard",
                            question: `Ø¬Ù…Ù„Ù‡ Ø²ÛŒØ± Ø±Ø§ ØªØµØ­ÛŒØ­ Ú©Ù†ÛŒØ¯:\n"${rule.common_mistakes[0]}"`,
                            options: generateCorrectionOptions(rule.common_mistakes[0], rule.examples),
                            correctAnswer: rule.examples[0],
                            explanation: `Ø®Ø·Ø§: ${rule.common_mistakes[0]} | ØµØ­ÛŒØ­: ${rule.examples[0]}`,
                            tags: ["ØªØµØ­ÛŒØ­ Ø®Ø·Ø§", "Ú¯Ø±Ø§Ù…Ø±"]
                        });
                    }

                    // Ø³ÙˆØ§Ù„ Ø³Ø§Ø®Øª Ø¬Ù…Ù„Ù‡
                    questions.push({
                        id: `grammar_build_${index}`,
                        type: "fill_blank",
                        category: "grammar",
                        subcategory: "sentence_building",
                        difficulty: "medium", 
                        question: `Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù‚Ø§Ø¹Ø¯Ù‡ "${rule.name}" Ø¬Ù…Ù„Ù‡â€ŒØ§ÛŒ Ø¨Ø³Ø§Ø²ÛŒØ¯:`,
                        correctAnswer: rule.examples[0],
                        explanation: rule.description,
                        tags: ["Ø¬Ù…Ù„Ù‡â€ŒØ³Ø§Ø²ÛŒ", "Ú©Ø§Ø±Ø¨Ø±Ø¯ Ø¹Ù…Ù„ÛŒ"]
                    });
                });
            }

            return questions;
        }

        function generateConversationQuestions(conversation) {
            const questions = [];
            
            if (conversation.dialogues) {
                conversation.dialogues.forEach((dialogue, index) => {
                    // Ø³ÙˆØ§Ù„ Ø§Ø¯Ø§Ù…Ù‡ Ù…Ú©Ø§Ù„Ù…Ù‡
                    questions.push({
                        id: `conv_continue_${index}`,
                        type: "multiple_choice",
                        category: "conversation", 
                        subcategory: "continuation",
                        difficulty: "medium",
                        question: `Ø¯Ø± Ù¾Ø§Ø³Ø® Ø¨Ù‡ Ø¬Ù…Ù„Ù‡ "${dialogue.lines[0]}" Ú†Ù‡ Ù…ÛŒâ€ŒÚ¯ÙˆÛŒÛŒØ¯ØŸ`,
                        options: generateConversationResponses(dialogue.lines[0], conversation.dialogues),
                        correctAnswer: dialogue.lines[1] || "I'm not sure",
                        explanation: `Ù…ÙˆÙ‚Ø¹ÛŒØª: ${dialogue.context || 'Ø¹Ù…ÙˆÙ…ÛŒ'}`,
                        tags: ["Ù…Ú©Ø§Ù„Ù…Ù‡", "ÙˆØ§Ú©Ù†Ø´"]
                    });

                    // Ø³ÙˆØ§Ù„ Ø¯Ø±Ú© Ù…Ø·Ù„Ø¨ Ù…Ú©Ø§Ù„Ù…Ù‡
                    if (dialogue.lines.length >= 2) {
                        questions.push({
                            id: `conv_comp_${index}`,
                            type: "multiple_choice",
                            category: "conversation",
                            subcategory: "comprehension",
                            difficulty: "easy",
                            question: `Ù…Ú©Ø§Ù„Ù…Ù‡ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ú†ÛŒØ³ØªØŸ\n"${dialogue.lines.slice(0, 2).join(' ')}"`,
                            options: [
                                "Ù…Ø¹Ø±ÙÛŒ Ùˆ Ø§Ø­ÙˆØ§Ù„Ù¾Ø±Ø³ÛŒ",
                                "Ù¾Ø±Ø³ÛŒØ¯Ù† Ø¢Ø¯Ø±Ø³", 
                                "Ø³ÙØ§Ø±Ø´ ØºØ°Ø§",
                                "ØµØ­Ø¨Øª Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø¢Ø¨ Ùˆ Ù‡ÙˆØ§"
                            ],
                            correctAnswer: dialogue.context || "Ù…Ø¹Ø±ÙÛŒ Ùˆ Ø§Ø­ÙˆØ§Ù„Ù¾Ø±Ø³ÛŒ",
                            explanation: `Ù…ÙˆØ¶ÙˆØ¹: ${dialogue.context || 'Ø¹Ù…ÙˆÙ…ÛŒ'}`,
                            tags: ["Ø¯Ø±Ú© Ù…Ø·Ù„Ø¨", "Ù…Ú©Ø§Ù„Ù…Ù‡"]
                        });
                    }
                });
            }

            return questions;
        }

        function generateMixedQuestions(vocab, grammar, conversation) {
            const questions = [];
            
            // Ø³ÙˆØ§Ù„Ø§Øª ØªØ±Ú©ÛŒØ¨ÛŒ - Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ú¯Ø±Ø§Ù…Ø± Ø¯Ø± Ù…Ú©Ø§Ù„Ù…Ù‡
            if (grammar.rules && conversation.dialogues) {
                grammar.rules.slice(0, 3).forEach((rule, index) => {
                    questions.push({
                        id: `mixed_grammar_conv_${index}`,
                        type: "multiple_choice",
                        category: "mixed",
                        subcategory: "grammar_in_conversation",
                        difficulty: "hard",
                        question: `Ú©Ø¯Ø§Ù… Ø¬Ù…Ù„Ù‡ Ø§Ø² Ù‚Ø§Ø¹Ø¯Ù‡ "${rule.name}" Ø¯Ø± Ù…Ú©Ø§Ù„Ù…Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ø±Ø¯Ù‡ Ø§Ø³ØªØŸ`,
                        options: generateMixedOptions(rule, conversation.dialogues),
                        correctAnswer: findGrammarInConversation(rule, conversation.dialogues),
                        explanation: `Ù‚Ø§Ø¹Ø¯Ù‡: ${rule.description}`,
                        tags: ["ØªØ±Ú©ÛŒØ¨ÛŒ", "Ú¯Ø±Ø§Ù…Ø± Ø¹Ù…Ù„ÛŒ"]
                    });
                });
            }

            // Ø³ÙˆØ§Ù„Ø§Øª ØªØ·Ø¨ÛŒÙ‚ ÙˆØ§Ú˜Ú¯Ø§Ù† Ùˆ Ù…Ø¹Ø§Ù†ÛŒ
            if (vocab.vocabulary) {
                questions.push({
                    id: "mixed_matching_1",
                    type: "matching",
                    category: "mixed",
                    subcategory: "vocabulary_matching", 
                    difficulty: "medium",
                    question: "Ú©Ù„Ù…Ø§Øª Ø±Ø§ Ø¨Ø§ Ù…Ø¹Ø§Ù†ÛŒ ØµØ­ÛŒØ­ ØªØ·Ø¨ÛŒÙ‚ Ø¯Ù‡ÛŒØ¯:",
                    pairs: generateMatchingPairs(vocab.vocabulary.slice(0, 5)),
                    explanation: "ØªØ·Ø¨ÛŒÙ‚ ÙˆØ§Ú˜Ú¯Ø§Ù† Ùˆ Ù…Ø¹Ø§Ù†ÛŒ",
                    tags: ["ØªØ·Ø¨ÛŒÙ‚", "ÙˆØ§Ú˜Ú¯Ø§Ù†"]
                });
            }

            return questions;
        }

        // ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ
        function generateWrongDefinitions(correctMeaning, vocabulary) {
            const wrongOnes = vocabulary
                .filter(v => v.meaning !== correctMeaning)
                .slice(0, 3)
                .map(v => v.meaning);
            return shuffleArray([correctMeaning, ...wrongOnes]);
        }

        function generateSynonymsAntonyms(meaning, vocabulary, isSynonym) {
            // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù…ØªØ±Ø§Ø¯Ù/Ù…ØªØ¶Ø§Ø¯ - Ø¯Ø± ÙˆØ§Ù‚Ø¹ÛŒØª Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø¯Ø§Ø±Ø¯
            const options = ["similar word", "different word", "opposite word", "unrelated word"];
            return shuffleArray([meaning, ...options.slice(0, 3)]);
        }

        function findSynonym(meaning, vocabulary) {
            return meaning; // Ø¯Ø± ÙˆØ§Ù‚Ø¹ÛŒØª Ø¨Ø§ÛŒØ¯ Ø¬Ø³ØªØ¬Ùˆ Ú©Ù†Ø¯
        }

        function generateGrammarExamples(correctRule, allRules) {
            const otherExamples = allRules
                .filter(r => r.name !== correctRule.name)
                .slice(0, 3)
                .map(r => r.examples[0]);
            return shuffleArray([correctRule.examples[0], ...otherExamples]);
        }

        function generateCorrectionOptions(wrongSentence, correctExamples) {
            const options = [correctExamples[0]];
            // ØªÙˆÙ„ÛŒØ¯ Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ù†Ø§Ø¯Ø±Ø³Øª Ù…Ø´Ø§Ø¨Ù‡
            for (let i = 1; i < 4; i++) {
                options.push(wrongSentence.replace(/not |don't /g, i % 2 === 0 ? "not " : "don't "));
            }
            return shuffleArray(options);
        }

        function generateConversationResponses(question, dialogues) {
            const responses = ["I'm fine, thank you", "I don't know", "Maybe later", "That sounds good"];
            return shuffleArray(responses);
        }

        function generateMixedOptions(rule, dialogues) {
            const options = [];
            // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ø¬Ù…Ù„Ø§Øª Ù…Ú©Ø§Ù„Ù…Ù‡ Ú©Ù‡ Ø§Ø² Ø§ÛŒÙ† Ù‚Ø§Ø¹Ø¯Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯
            dialogues.forEach(dialogue => {
                dialogue.lines.forEach(line => {
                    if (line.includes('ing') && rule.name.includes('Present Continuous')) {
                        options.push(line);
                    }
                });
            });
            while (options.length < 4) {
                options.push("Sample sentence " + options.length);
            }
            return shuffleArray(options.slice(0, 4));
        }

        function findGrammarInConversation(rule, dialogues) {
            // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ø§ÙˆÙ„ÛŒÙ† Ø¬Ù…Ù„Ù‡ Ù…Ú©Ø§Ù„Ù…Ù‡ Ú©Ù‡ Ù‚Ø§Ø¹Ø¯Ù‡ Ø±Ø§ Ù†Ø´Ø§Ù† Ù…ÛŒâ€ŒØ¯Ù‡Ø¯
            for (let dialogue of dialogues) {
                for (let line of dialogue.lines) {
                    if (line.includes('ing') && rule.name.includes('Present Continuous')) {
                        return line;
                    }
                }
            }
            return dialogues[0]?.lines[0] || "Not found";
        }

        function generateMatchingPairs(vocabulary) {
            return vocabulary.map((word, index) => ({
                left: word.word,
                right: word.meaning,
                id: `pair_${index}`
            }));
        }

        function shuffleArray(array) {
            return array.sort(() => Math.random() - 0.5);
        }

        function showPreview(quiz) {
            const statsDiv = document.getElementById('stats');
            const previewDiv = document.getElementById('preview');
            
            // Ù†Ù…Ø§ÛŒØ´ Ø¢Ù…Ø§Ø±
            statsDiv.innerHTML = `
                <h3>ğŸ“Š Ø¢Ù…Ø§Ø± ØªÙˆÙ„ÛŒØ¯ Ø´Ø¯Ù‡:</h3>
                <p>âœ… Ú©Ù„ Ø³ÙˆØ§Ù„Ø§Øª: ${quiz.metadata.totalQuestions}</p>
                <p>ğŸ“š ÙˆØ§Ú˜Ú¯Ø§Ù†: ${quiz.vocabulary.length} Ø³ÙˆØ§Ù„</p>
                <p>ğŸ”¤ Ú¯Ø±Ø§Ù…Ø±: ${quiz.grammar.length} Ø³ÙˆØ§Ù„</p>
                <p>ğŸ’¬ Ù…Ú©Ø§Ù„Ù…Ù‡: ${quiz.conversation.length} Ø³ÙˆØ§Ù„</p>
                <p>ğŸ¯ ØªØ±Ú©ÛŒØ¨ÛŒ: ${quiz.mixed.length} Ø³ÙˆØ§Ù„</p>
                <p>â± Ø²Ù…Ø§Ù† ØªØ®Ù…ÛŒÙ†ÛŒ: ${quiz.metadata.estimatedTime}</p>
            `;
            statsDiv.style.display = 'block';

            // Ù†Ù…Ø§ÛŒØ´ Ù†Ù…ÙˆÙ†Ù‡ Ø³ÙˆØ§Ù„Ø§Øª
            let previewHTML = '<h3>ğŸ” Ù†Ù…ÙˆÙ†Ù‡ Ø³ÙˆØ§Ù„Ø§Øª ØªÙˆÙ„ÛŒØ¯ Ø´Ø¯Ù‡:</h3>';
            
            // Ù†Ù…ÙˆÙ†Ù‡ Ø§Ø² Ù‡Ø± Ø¯Ø³ØªÙ‡
            [quiz.vocabulary[0], quiz.grammar[0], quiz.conversation[0], quiz.mixed[0]].forEach((q, i) => {
                if (q) {
                    previewHTML += `
                        <div class="question-sample">
                            <strong>${['ÙˆØ§Ú˜Ú¯Ø§Ù†', 'Ú¯Ø±Ø§Ù…Ø±', 'Ù…Ú©Ø§Ù„Ù…Ù‡', 'ØªØ±Ú©ÛŒØ¨ÛŒ'][i]}:</strong><br>
                            <em>${q.question}</em><br>
                            <small>Ù†ÙˆØ¹: ${q.type} | Ø³Ø·Ø­: ${q.difficulty}</small>
                        </div>
                    `;
                }
            });

            previewDiv.innerHTML = previewHTML;
            previewDiv.style.display = 'block';
        }

        function downloadQuiz() {
            if (!generatedQuiz) return;
            
            const dataStr = JSON.stringify(generatedQuiz, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = 'quiz.json';
            link.click();
        }
    </script>
</body>
</html>
