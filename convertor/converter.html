<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù…Ø¨Ø¯Ù„ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ English7App - Ú©Ø§Ù…Ù„</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Vazirmatn', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            margin: 0;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
            font-size: 28px;
            background: linear-gradient(90deg, #4CAF50, #2196F3);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border-right: 5px solid #4CAF50;
            transition: transform 0.3s;
        }
        
        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .btn {
            background: linear-gradient(135deg, #4CAF50, #388E3C);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: 0.3s;
            display: inline-block;
            min-width: 180px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .btn-convert {
            background: linear-gradient(135deg, #2196F3, #1976D2);
        }
        
        .btn-download {
            background: linear-gradient(135deg, #FF9800, #F57C00);
        }
        
        .btn-all {
            background: linear-gradient(135deg, #9C27B0, #7B1FA2);
            padding: 15px 30px;
            font-size: 18px;
            font-weight: bold;
        }
        
        .file-input {
            width: 100%;
            margin: 15px 0;
            padding: 15px;
            border: 2px dashed #ccc;
            border-radius: 8px;
            text-align: center;
            background: white;
            cursor: pointer;
            transition: 0.3s;
        }
        
        .file-input:hover {
            border-color: #4CAF50;
            background: #f0fff0;
        }
        
        .stats {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-size: 14px;
        }
        
        .progress {
            height: 10px;
            background: #e0e0e0;
            border-radius: 5px;
            margin: 15px 0;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            width: 0%;
            transition: width 0.5s;
        }
        
        .status {
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            background: #e3f2fd;
            display: none;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .status.success {
            background: #e8f5e9;
            color: #2e7d32;
            border-right: 5px solid #4CAF50;
        }
        
        .status.error {
            background: #ffebee;
            color: #c62828;
            border-right: 5px solid #f44336;
        }
        
        .status.info {
            background: #e3f2fd;
            color: #1565c0;
            border-right: 5px solid #2196F3;
        }
        
        .file-list {
            background: #fff3e0;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .file-item {
            padding: 8px;
            margin: 5px 0;
            background: white;
            border-radius: 5px;
            border-left: 4px solid #FF9800;
        }
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@vazirmatn/matn@1.0.0-alpha.2/vazirmatn.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <h1><i class="fas fa-sync-alt"></i> Ù…Ø¨Ø¯Ù„ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ English7App</h1>
        
        <!-- Ù‚Ø¯Ù… 1: Ø¢Ù¾Ù„ÙˆØ¯ vocab.json -->
        <div class="card">
            <h3><i class="fas fa-file-upload"></i> Ù‚Ø¯Ù… 1: Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„ vocab.json</h3>
            <p>ÙØ§ÛŒÙ„ vocab.json Ø±Ùˆ Ø§Ø² Ù¾ÙˆØ´Ù‡ data/lesson1 Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†:</p>
            <input type="file" id="vocabFile" accept=".json" class="file-input">
            <div id="fileInfo" class="stats"></div>
            <div class="progress">
                <div id="progressBar" class="progress-bar"></div>
            </div>
        </div>
        
        <!-- Ù‚Ø¯Ù… 2: ØªØ¨Ø¯ÛŒÙ„ -->
        <div class="card">
            <h3><i class="fas fa-cogs"></i> Ù‚Ø¯Ù… 2: ØªØ¨Ø¯ÛŒÙ„ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§</h3>
            <p>Ù‡Ø± Ú©Ø¯ÙˆÙ… Ø±Ùˆ Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ ÛŒØ§ Ù‡Ù…Ù‡ Ø±Ùˆ ÛŒÚ©Ø¬Ø§ ØªØ¨Ø¯ÛŒÙ„ Ú©Ù†:</p>
            
            <div style="text-align: center;">
                <button class="btn btn-convert" onclick="convertToFlashcards()">
                    <i class="fas fa-layer-group"></i> Ø¨Ø³Ø§Ø² flashcards.json
                </button>
                
                <button class="btn btn-convert" onclick="convertToReview()">
                    <i class="fas fa-history"></i> Ø¨Ø³Ø§Ø² review.json
                </button>
                
                <button class="btn btn-convert" onclick="convertToGames()">
                    <i class="fas fa-gamepad"></i> Ø¨Ø³Ø§Ø² games.json
                </button>
                
                <br><br>
                
                <button class="btn btn-all" onclick="convertAll()">
                    <i class="fas fa-bolt"></i> Ù‡Ù…Ù‡ Ø±Ùˆ ÛŒÚ©Ø¬Ø§ Ø¨Ø³Ø§Ø²
                </button>
            </div>
        </div>
        
        <!-- Ù‚Ø¯Ù… 3: Ø¯Ø§Ù†Ù„ÙˆØ¯ -->
        <div class="card">
            <h3><i class="fas fa-download"></i> Ù‚Ø¯Ù… 3: Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§</h3>
            <p>ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªÙˆÙ„ÛŒØ¯ Ø´Ø¯Ù‡:</p>
            <div id="downloadButtons"></div>
            
            <div id="fileList" class="file-list" style="display: none;">
                <h4><i class="fas fa-list"></i> ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¢Ù…Ø§Ø¯Ù‡:</h4>
                <div id="filesContainer"></div>
            </div>
        </div>
        
        <!-- ÙˆØ¶Ø¹ÛŒØª -->
        <div id="status" class="status"></div>
    </div>

    <script>
        let vocabData = [];
        let convertedFiles = {};
        
        // 1. Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„ vocab.json
        document.getElementById('vocabFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            const progressBar = document.getElementById('progressBar');
            
            reader.onprogress = function(event) {
                if (event.lengthComputable) {
                    const percent = (event.loaded / event.total) * 100;
                    progressBar.style.width = percent + '%';
                }
            };
            
            reader.onload = function(event) {
                progressBar.style.width = '100%';
                
                try {
                    vocabData = JSON.parse(event.target.result);
                    
                    // Ø¨Ø±Ø±Ø³ÛŒ Ø³Ø§Ø®ØªØ§Ø±
                    if (!Array.isArray(vocabData)) {
                        if (vocabData.words && Array.isArray(vocabData.words)) {
                            vocabData = vocabData.words;
                        } else if (vocabData.vocabulary && Array.isArray(vocabData.vocabulary)) {
                            vocabData = vocabData.vocabulary;
                        } else {
                            throw new Error('Ø³Ø§Ø®ØªØ§Ø± JSON Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª');
                        }
                    }
                    
                    document.getElementById('fileInfo').innerHTML = `
                        <i class="fas fa-check-circle"></i> ÙØ§ÛŒÙ„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯
                        <br><i class="fas fa-chart-bar"></i> ØªØ¹Ø¯Ø§Ø¯ Ù„ØºØ§Øª: <strong>${vocabData.length}</strong>
                        <br><i class="fas fa-hdd"></i> Ø­Ø¬Ù… ÙØ§ÛŒÙ„: <strong>${(file.size / 1024).toFixed(1)} KB</strong>
                        <br><i class="fas fa-file-alt"></i> Ù†Ø§Ù… ÙØ§ÛŒÙ„: <strong>${file.name}</strong>
                    `;
                    
                    showStatus(`âœ… ÙØ§ÛŒÙ„ vocab.json Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯ (${vocabData.length} Ù„ØºØª)`, 'success');
                    
                    // Ù†Ù…ÙˆÙ†Ù‡ Ø§Ø² Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
                    console.log('Ù†Ù…ÙˆÙ†Ù‡ Ù„ØºØ§Øª:', vocabData.slice(0, 3));
                    
                } catch (error) {
                    showStatus(`âŒ Ø®Ø·Ø§ Ø¯Ø± Ø®ÙˆØ§Ù†Ø¯Ù† ÙØ§ÛŒÙ„ JSON: ${error.message}`, 'error');
                    console.error('Ø®Ø·Ø§ÛŒ Ù¾Ø§Ø±Ø³:', error);
                }
                
                setTimeout(() => {
                    progressBar.style.width = '0%';
                }, 1000);
            };
            
            reader.onerror = function() {
                showStatus('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø®ÙˆØ§Ù†Ø¯Ù† ÙØ§ÛŒÙ„', 'error');
            };
            
            showStatus('ğŸ“¥ Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ§ÛŒÙ„...', 'info');
            reader.readAsText(file);
        });
        
        // 2. ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ flashcards.json
        function convertToFlashcards() {
            if (!vocabData.length) {
                showStatus('âŒ Ø§ÙˆÙ„ ÙØ§ÛŒÙ„ vocab.json Ø±Ùˆ Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†', 'error');
                return;
            }
            
            showStatus('ğŸ”„ Ø¯Ø± Ø­Ø§Ù„ Ø³Ø§Ø®Øª flashcards.json...', 'info');
            
            try {
                const flashcards = [];
                const maxCards = Math.min(100, vocabData.length);
                
                for (let i = 0; i < maxCards; i++) {
                    const word = vocabData[i];
                    if (!word) continue;
                    
                    const firstMeaning = word.meanings?.[0] || {};
                    const example = firstMeaning.example || {};
                    
                    flashcards.push({
                        id: `g7_l1_fc${i + 1}`,
                        word: word.word || word.english || '',
                        phonetic: word.phonetic?.us || word.phonetic?.uk || word.pronunciation || '',
                        persianMeaning: word.persian?.main || word.persian?.short || word.translation || word.farsi || '',
                        example: example.sentence || `${word.word} is an important word.`,
                        exampleTranslation: example.translation || `ÙˆØ§Ú˜Ù‡ ${word.word} Ù…Ù‡Ù… Ø§Ø³Øª.`,
                        difficulty: mapDifficulty(word.level || word.difficulty)
                    });
                }
                
                convertedFiles.flashcards = flashcards;
                createDownloadButton('flashcards.json', flashcards, 'flashcards');
                showStatus(`âœ… flashcards.json Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯ (${flashcards.length} Ú©Ø§Ø±Øª)`, 'success');
                
            } catch (error) {
                showStatus(`âŒ Ø®Ø·Ø§ Ø¯Ø± Ø³Ø§Ø®Øª flashcards: ${error.message}`, 'error');
                console.error(error);
            }
        }
        
        // 3. ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ review.json
        function convertToReview() {
            if (!vocabData.length) {
                showStatus('âŒ Ø§ÙˆÙ„ ÙØ§ÛŒÙ„ vocab.json Ø±Ùˆ Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†', 'error');
                return;
            }
            
            showStatus('ğŸ”„ Ø¯Ø± Ø­Ø§Ù„ Ø³Ø§Ø®Øª review.json...', 'info');
            
            try {
                const now = new Date().toISOString();
                const cards = [];
                const maxCards = Math.min(100, vocabData.length);
                
                for (let i = 0; i < maxCards; i++) {
                    const word = vocabData[i];
                    if (!word) continue;
                    
                    const firstMeaning = word.meanings?.[0] || {};
                    const example = firstMeaning.example || {};
                    
                    cards.push({
                        id: `card_${String(i + 1).padStart(3, '0')}`,
                        word: word.word || word.english || '',
                        phonetic: word.phonetic?.us || word.phonetic?.uk || word.pronunciation || '',
                        translation: word.persian?.main || word.persian?.short || word.translation || word.farsi || '',
                        example: example.sentence || `Example for ${word.word}`,
                        category: getCategory(word.level || word.difficulty),
                        difficulty: mapDifficultyPersian(word.level || word.difficulty),
                        audioUrl: word.audio?.us || word.audio?.uk || word.audio || `audio/${word.word}.mp3`,
                        imageUrl: `images/${word.word || 'default'}.png`,
                        tags: ['Ù¾Ø§ÛŒÙ‡', word.level || 'A1', word.partOfSpeech?.[0] || 'noun'].filter(Boolean),
                        leitner: {
                            box: 1,
                            due: true,
                            nextReview: getNextReviewDate(1),
                            interval: 1,
                            reviews: 0,
                            ease: 2.5,
                            isNew: true
                        }
                    });
                }
                
                // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¢Ù…Ø§Ø±
                const easyCount = cards.filter(c => c.difficulty === 'Ø¢Ø³Ø§Ù†').length;
                const mediumCount = cards.filter(c => c.difficulty === 'Ù…ØªÙˆØ³Ø·').length;
                const hardCount = cards.filter(c => c.difficulty === 'Ø³Ø®Øª').length;
                
                const reviewData = {
                    version: "3.0",
                    lessonId: "lesson1",
                    lessonTitle: "Ø¯Ø±Ø³ Ø§ÙˆÙ„",
                    createdAt: now,
                    lastUpdated: now,
                    cards: cards,
                    metadata: {
                        totalCards: cards.length,
                        difficultyDistribution: {
                            "Ø¢Ø³Ø§Ù†": easyCount,
                            "Ù…ØªÙˆØ³Ø·": mediumCount,
                            "Ø³Ø®Øª": hardCount
                        },
                        categories: ["Ù¾Ø§ÛŒÙ‡", "Ù…ØªÙˆØ³Ø·", "Ù¾ÛŒØ´Ø±ÙØªÙ‡"],
                        averageReviewTime: 30,
                        recommendedDailyCards: Math.min(20, Math.floor(cards.length / 3)),
                        createdBy: "English7App",
                        suitableFor: "Ù¾Ø§ÛŒÙ‡ Ù‡ÙØªÙ…"
                    }
                };
                
                convertedFiles.review = reviewData;
                createDownloadButton('review.json', reviewData, 'review');
                showStatus(`âœ… review.json Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯ (${cards.length} Ú©Ø§Ø±Øª Ù…Ø±ÙˆØ±)`, 'success');
                
            } catch (error) {
                showStatus(`âŒ Ø®Ø·Ø§ Ø¯Ø± Ø³Ø§Ø®Øª review: ${error.message}`, 'error');
                console.error(error);
            }
        }
        
        // 4. ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ games.json - Ù†Ø³Ø®Ù‡ Ú©Ø§Ù…Ù„
        function convertToGames() {
            if (!vocabData.length) {
                showStatus('âŒ Ø§ÙˆÙ„ ÙØ§ÛŒÙ„ vocab.json Ø±Ùˆ Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†', 'error');
                return;
            }
            
            showStatus('ğŸ”„ Ø¯Ø± Ø­Ø§Ù„ Ø³Ø§Ø®Øª games.json...', 'info');
            
            try {
                // Ø§Ø² Ù‡Ù…Ù‡ Ù„ØºØ§Øª Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†
                const allWords = vocabData;
                const wordCount = Math.min(allWords.length, 200); // Ø­Ø¯Ø§Ú©Ø«Ø± 200 Ù„ØºØª
                
                console.log(`Ø³Ø§Ø®Øª Ø¨Ø§Ø²ÛŒ Ø¨Ø±Ø§ÛŒ ${wordCount} Ù„ØºØª`);
                
                // 1. Ø¨Ø§Ø²ÛŒâ€ŒÙ‡Ø§ÛŒ Ø­Ø§ÙØ¸Ù‡ (Memory)
                const memoryGames = [];
                
                // ØªÙ‚Ø³ÛŒÙ… Ù„ØºØ§Øª Ø¨Ù‡ Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§ÛŒ 12 ØªØ§ÛŒÛŒ Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²ÛŒ Ø­Ø§ÙØ¸Ù‡
                const groups = [];
                for (let i = 0; i < wordCount; i += 12) {
                    const group = allWords.slice(i, i + 12);
                    if (group.length >= 4) { // Ø­Ø¯Ø§Ù‚Ù„ 4 Ù„ØºØª Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²ÛŒ
                        groups.push(group);
                    }
                }
                
                // Ø³Ø§Ø®Øª Ø¨Ø§Ø²ÛŒâ€ŒÙ‡Ø§ÛŒ Ø­Ø§ÙØ¸Ù‡
                groups.forEach((group, index) => {
                    const pairs = group.map(w => ({
                        en: w.word || w.english || '',
                        fa: w.persian?.main || w.persian?.short || w.translation || w.farsi || 'Ù…Ø¹Ù†ÛŒ'
                    })).filter(p => p.en && p.fa && p.fa !== 'Ù…Ø¹Ù†ÛŒ');
                    
                    if (pairs.length >= 4) {
                        memoryGames.push({
                            id: `mem_l1_${index + 1}`,
                            type: "memory",
                            title: `Ø­Ø§ÙØ¸Ù‡ Ù„ØºØ§Øª - Ø¨Ø®Ø´ ${index + 1}`,
                            pairs: pairs
                        });
                    }
                });
                
                // 2. Ø¨Ø§Ø²ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ (Scramble)
                const scrambleGames = [];
                
                // ØªÙ‚Ø³ÛŒÙ… Ù„ØºØ§Øª Ø¨Ù‡ Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§ÛŒ 15 ØªØ§ÛŒÛŒ
                for (let i = 0; i < wordCount; i += 15) {
                    const group = allWords.slice(i, i + 15);
                    const items = group.map(w => ({
                        word: (w.word || w.english || '').toLowerCase().replace(/\s/g, ''),
                        hint: w.persian?.main || w.persian?.short || w.translation || w.farsi || 'Ù…Ø¹Ù†ÛŒ'
                    })).filter(item => item.word && item.hint && item.hint !== 'Ù…Ø¹Ù†ÛŒ');
                    
                    if (items.length >= 5) {
                        scrambleGames.push({
                            id: `scr_l1_${scrambleGames.length + 1}`,
                            type: "scramble",
                            title: `Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ Ø­Ø±ÙˆÙ - Ú¯Ø±ÙˆÙ‡ ${scrambleGames.length + 1}`,
                            items: items
                        });
                    }
                }
                
                // 3. Ø¨Ø§Ø²ÛŒ Ø­Ø§ÙØ¸Ù‡ Ø¬Ù…Ù„Ø§Øª
                const sentenceGames = [];
                const wordsWithExamples = allWords.filter(w => 
                    w.meanings?.[0]?.example?.sentence
                ).slice(0, 12); // Ø­Ø¯Ø§Ú©Ø«Ø± 12 Ø¬Ù…Ù„Ù‡
                
                if (wordsWithExamples.length >= 4) {
                    const sentencePairs = wordsWithExamples.map(w => ({
                        en: w.meanings[0].example.sentence,
                        fa: w.meanings[0].example.translation || w.persian?.main || 'ØªØ±Ø¬Ù…Ù‡'
                    }));
                    
                    sentenceGames.push({
                        id: "mem_l1_sentences",
                        type: "memory",
                        title: "Ø­Ø§ÙØ¸Ù‡ Ø¬Ù…Ù„Ù‡â€ŒÙ‡Ø§",
                        pairs: sentencePairs
                    });
                }
                
                // ØªØ±Ú©ÛŒØ¨ Ù‡Ù…Ù‡ Ø¨Ø§Ø²ÛŒâ€ŒÙ‡Ø§
                const allGames = [...memoryGames, ...scrambleGames, ...sentenceGames];
                
                // Ø§Ú¯Ø± Ø¨Ø§Ø²ÛŒâ€ŒÙ‡Ø§ Ú©Ù… Ø¨ÙˆØ¯Ù†ØŒ ÛŒÙ‡ Ø¨Ø§Ø²ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†
                if (allGames.length < 3 && wordCount >= 10) {
                    const extraPairs = allWords.slice(0, 8).map(w => ({
                        en: w.word || w.english || '',
                        fa: w.persian?.main || w.persian?.short || w.translation || w.farsi || 'Ù…Ø¹Ù†ÛŒ'
                    })).filter(p => p.en && p.fa);
                    
                    if (extraPairs.length >= 4) {
                        allGames.push({
                            id: "mem_l1_extra",
                            type: "memory",
                            title: "Ø­Ø§ÙØ¸Ù‡ Ù„ØºØ§Øª Ù¾Ø§ÛŒÙ‡",
                            pairs: extraPairs
                        });
                    }
                }
                
                const gamesData = {
                    games: allGames
                };
                
                convertedFiles.games = gamesData;
                createDownloadButton('games.json', gamesData, 'games');
                showStatus(`âœ… games.json Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯ (${allGames.length} Ø¨Ø§Ø²ÛŒØŒ ${wordCount} Ù„ØºØª)`, 'success');
                
            } catch (error) {
                showStatus(`âŒ Ø®Ø·Ø§ Ø¯Ø± Ø³Ø§Ø®Øª games: ${error.message}`, 'error');
                console.error('Ø®Ø·Ø§ÛŒ Ø³Ø§Ø®Øª games:', error);
            }
        }
        
        // 5. ØªØ¨Ø¯ÛŒÙ„ Ù‡Ù…Ù‡ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§
        function convertAll() {
            if (!vocabData.length) {
                showStatus('âŒ Ø§ÙˆÙ„ ÙØ§ÛŒÙ„ vocab.json Ø±Ùˆ Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†', 'error');
                return;
            }
            
            showStatus('âš¡ Ø¯Ø± Ø­Ø§Ù„ ØªØ¨Ø¯ÛŒÙ„ Ù‡Ù…Ù‡ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§...', 'info');
            
            // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ
            document.getElementById('downloadButtons').innerHTML = '';
            document.getElementById('filesContainer').innerHTML = '';
            
            // ØªØ¨Ø¯ÛŒÙ„ ØªØ±ØªÛŒØ¨ÛŒ
            setTimeout(() => convertToFlashcards(), 100);
            setTimeout(() => convertToReview(), 500);
            setTimeout(() => convertToGames(), 1000);
            
            setTimeout(() => {
                document.getElementById('fileList').style.display = 'block';
                updateFileList();
                showStatus('ğŸ‰ Ù‡Ù…Ù‡ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯Ù†Ø¯!', 'success');
            }, 1500);
        }
        
        // ========== ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ ==========
        function mapDifficulty(level) {
            if (!level) return 'easy';
            level = String(level).toUpperCase();
            if (level.includes('B')) return 'medium';
            if (level.includes('C')) return 'hard';
            return 'easy';
        }
        
        function mapDifficultyPersian(level) {
            if (!level) return 'Ø¢Ø³Ø§Ù†';
            level = String(level).toUpperCase();
            if (level.includes('B')) return 'Ù…ØªÙˆØ³Ø·';
            if (level.includes('C')) return 'Ø³Ø®Øª';
            return 'Ø¢Ø³Ø§Ù†';
        }
        
        function getCategory(level) {
            if (!level) return 'Ù¾Ø§ÛŒÙ‡';
            level = String(level).toUpperCase();
            if (level.includes('A')) return 'Ù¾Ø§ÛŒÙ‡';
            if (level.includes('B')) return 'Ù…ØªÙˆØ³Ø·';
            return 'Ù¾ÛŒØ´Ø±ÙØªÙ‡';
        }
        
        function getNextReviewDate(box) {
            const date = new Date();
            date.setDate(date.getDate() + box);
            return date.toISOString().split('T')[0];
        }
        
        function createDownloadButton(filename, data, type) {
            // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡ Ù‚Ø¨Ù„ÛŒ Ø¨Ø§ Ù‡Ù…ÛŒÙ† Ù†Ø§Ù…
            const existingBtn = document.querySelector(`[data-filename="${filename}"]`);
            if (existingBtn) existingBtn.remove();
            
            const jsonStr = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const btn = document.createElement('button');
            btn.className = 'btn btn-download';
            btn.setAttribute('data-filename', filename);
            btn.innerHTML = `<i class="fas fa-download"></i> Ø¯Ø§Ù†Ù„ÙˆØ¯ ${filename}`;
            btn.onclick = () => {
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                
                // Ø±Ù‡Ø§ Ú©Ø±Ø¯Ù† URL Ø¨Ø¹Ø¯ Ø§Ø² Ø¯Ø§Ù†Ù„ÙˆØ¯
                setTimeout(() => URL.revokeObjectURL(url), 100);
            };
            
            document.getElementById('downloadButtons').appendChild(btn);
            
            // Ø°Ø®ÛŒØ±Ù‡ Ø¨Ø±Ø§ÛŒ Ù„ÛŒØ³Øª ÙØ§ÛŒÙ„â€ŒÙ‡Ø§
            convertedFiles[type] = {
                filename: filename,
                data: data,
                size: (jsonStr.length / 1024).toFixed(1) + ' KB',
                items: Array.isArray(data) ? data.length : 
                       data.games ? data.games.length : 
                       data.cards ? data.cards.length : 0
            };
            
            updateFileList();
        }
        
        function updateFileList() {
            const container = document.getElementById('filesContainer');
            container.innerHTML = '';
            
            const files = [
                { key: 'flashcards', name: 'flashcards.json', icon: 'fa-layer-group' },
                { key: 'review', name: 'review.json', icon: 'fa-history' },
                { key: 'games', name: 'games.json', icon: 'fa-gamepad' }
            ];
            
            files.forEach(file => {
                if (convertedFiles[file.key]) {
                    const info = convertedFiles[file.key];
                    const div = document.createElement('div');
                    div.className = 'file-item';
                    div.innerHTML = `
                        <i class="fas ${file.icon}"></i> 
                        <strong>${file.name}</strong>
                        <br>
                        <small>
                            <i class="fas fa-hashtag"></i> ${info.items} Ø¢ÛŒØªÙ…
                            | <i class="fas fa-hdd"></i> ${info.size}
                            | <i class="fas fa-check-circle"></i> Ø¢Ù…Ø§Ø¯Ù‡ Ø¯Ø§Ù†Ù„ÙˆØ¯
                        </small>
                    `;
                    container.appendChild(div);
                }
            });
            
            if (container.children.length > 0) {
                document.getElementById('fileList').style.display = 'block';
            }
        }
        
        function showStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<i class="fas fa-info-circle"></i> ${message}`;
            statusDiv.className = `status ${type}`;
            statusDiv.style.display = 'block';
            
            if (type === 'error') {
                console.error('Status Error:', message);
            }
            
            setTimeout(() => {
                if (statusDiv.innerHTML.includes(message)) {
                    statusDiv.style.display = 'none';
                }
            }, 8000);
        }
        
        // Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
        showStatus('ğŸ“ Ù„Ø·ÙØ§ ÙØ§ÛŒÙ„ vocab.json Ø±Ø§ Ø§Ø² Ù¾ÙˆØ´Ù‡ data/lesson1 Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯', 'info');
    </script>
</body>
</html>