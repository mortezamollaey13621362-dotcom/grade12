<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù…Ø¨Ø¯Ù„ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ English7App - Ú©Ø§Ù…Ù„</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Vazirmatn', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            margin: 0;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
            font-size: 28px;
            background: linear-gradient(90deg, #4CAF50, #2196F3);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
            border-right: 5px solid #4CAF50;
            transition: transform 0.3s;
        }
        
        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .btn {
            background: linear-gradient(135deg, #4CAF50, #388E3C);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: 0.3s;
            display: inline-block;
            min-width: 180px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .btn-convert {
            background: linear-gradient(135deg, #2196F3, #1976D2);
        }
        
        .btn-download {
            background: linear-gradient(135deg, #FF9800, #F57C00);
        }
        
        .btn-all {
            background: linear-gradient(135deg, #9C27B0, #7B1FA2);
            padding: 15px 30px;
            font-size: 18px;
            font-weight: bold;
        }
        
        .btn-debug {
            background: linear-gradient(135deg, #607d8b, #455a64);
        }
        
        .file-input {
            width: 100%;
            margin: 15px 0;
            padding: 15px;
            border: 2px dashed #ccc;
            border-radius: 8px;
            text-align: center;
            background: white;
            cursor: pointer;
            transition: 0.3s;
        }
        
        .file-input:hover {
            border-color: #4CAF50;
            background: #f0fff0;
        }
        
        .stats {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-size: 14px;
        }
        
        .progress {
            height: 10px;
            background: #e0e0e0;
            border-radius: 5px;
            margin: 15px 0;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            width: 0%;
            transition: width 0.5s;
        }
        
        .status {
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            background: #e3f2fd;
            display: none;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .status.success {
            background: #e8f5e9;
            color: #2e7d32;
            border-right: 5px solid #4CAF50;
        }
        
        .status.error {
            background: #ffebee;
            color: #c62828;
            border-right: 5px solid #f44336;
        }
        
        .status.info {
            background: #e3f2fd;
            color: #1565c0;
            border-right: 5px solid #2196F3;
        }
        
        .file-list {
            background: #fff3e0;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .file-item {
            padding: 10px;
            margin: 8px 0;
            background: white;
            border-radius: 5px;
            border-left: 4px solid #FF9800;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .file-info {
            flex-grow: 1;
        }
        
        .file-actions {
            display: flex;
            gap: 10px;
        }
        
        .counter {
            background: #e3f2fd;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            display: inline-block;
            margin-left: 10px;
        }
        
        .conversion-info {
            background: #f3e5f5;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 13px;
        }
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@vazirmatn/matn@1.0.0-alpha.2/vazirmatn.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <h1><i class="fas fa-sync-alt"></i> Ù…Ø¨Ø¯Ù„ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ English7App - Ù†Ø³Ø®Ù‡ Ú©Ø§Ù…Ù„</h1>
        
        <!-- Ù‚Ø¯Ù… 1: Ø¢Ù¾Ù„ÙˆØ¯ vocab.json -->
        <div class="card">
            <h3><i class="fas fa-file-upload"></i> Ù‚Ø¯Ù… 1: Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„ vocab.json</h3>
            <p>ÙØ§ÛŒÙ„ vocab.json Ø±Ùˆ Ø§Ø² Ù¾ÙˆØ´Ù‡ data/ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù† (ØªÙ…Ø§Ù…ÛŒ Ù„ØºØ§Øª ØªØ¨Ø¯ÛŒÙ„ Ø®ÙˆØ§Ù‡Ù†Ø¯ Ø´Ø¯):</p>
            <input type="file" id="vocabFile" accept=".json" class="file-input">
            <div id="fileInfo" class="stats"></div>
            <div class="progress">
                <div id="progressBar" class="progress-bar"></div>
            </div>
        </div>
        
        <!-- Ù‚Ø¯Ù… 2: ØªØ¨Ø¯ÛŒÙ„ -->
        <div class="card">
            <h3><i class="fas fa-cogs"></i> Ù‚Ø¯Ù… 2: ØªØ¨Ø¯ÛŒÙ„ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§</h3>
            <p><i class="fas fa-info-circle"></i> Ù‡Ù…Ù‡ Ù„ØºØ§Øª Ø¨Ø¯ÙˆÙ† Ù…Ø­Ø¯ÙˆØ¯ÛŒØª ØªØ¨Ø¯ÛŒÙ„ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯:</p>
            
            <div style="text-align: center;">
                <button class="btn btn-convert" onclick="convertToFlashcards()">
                    <i class="fas fa-layer-group"></i> Ø¨Ø³Ø§Ø² flashcards.json
                </button>
                
                <button class="btn btn-convert" onclick="convertToReview()">
                    <i class="fas fa-history"></i> Ø¨Ø³Ø§Ø² review.json
                </button>
                
                <button class="btn btn-convert" onclick="convertToGames()">
                    <i class="fas fa-gamepad"></i> Ø¨Ø³Ø§Ø² games.json
                </button>
                
                <br><br>
                
                <button class="btn btn-all" onclick="convertAll()">
                    <i class="fas fa-bolt"></i> Ù‡Ù…Ù‡ Ø±Ùˆ ÛŒÚ©Ø¬Ø§ Ø¨Ø³Ø§Ø²
                </button>
                
                <button class="btn btn-debug" onclick="debugStructure()">
                    <i class="fas fa-bug"></i> Ø¨Ø±Ø±Ø³ÛŒ Ø³Ø§Ø®ØªØ§Ø±
                </button>
            </div>
            
            <div class="conversion-info">
                <i class="fas fa-info-circle"></i> <strong>ØªÙˆØ¬Ù‡:</strong> Ø§ÛŒÙ† Ù†Ø³Ø®Ù‡ ØªÙ…Ø§Ù…ÛŒ Ù„ØºØ§Øª ÙØ§ÛŒÙ„ vocab.json Ø±Ø§ Ø¨Ø¯ÙˆÙ† Ù…Ø­Ø¯ÙˆØ¯ÛŒØª ØªØ¨Ø¯ÛŒÙ„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.
            </div>
        </div>
        
        <!-- Ù‚Ø¯Ù… 3: Ø¯Ø§Ù†Ù„ÙˆØ¯ -->
        <div class="card">
            <h3><i class="fas fa-download"></i> Ù‚Ø¯Ù… 3: Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§</h3>
            <p>ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªÙˆÙ„ÛŒØ¯ Ø´Ø¯Ù‡:</p>
            <div id="downloadButtons"></div>
            
            <div id="fileList" class="file-list" style="display: none;">
                <h4><i class="fas fa-list"></i> ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¢Ù…Ø§Ø¯Ù‡:</h4>
                <div id="filesContainer"></div>
            </div>
        </div>
        
        <!-- ÙˆØ¶Ø¹ÛŒØª -->
        <div id="status" class="status"></div>
    </div>

    <script>
        let vocabData = [];
        let convertedFiles = {};
        let fileStructure = {};
        
        // 1. Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„ vocab.json
        document.getElementById('vocabFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            const progressBar = document.getElementById('progressBar');
            
            reader.onprogress = function(event) {
                if (event.lengthComputable) {
                    const percent = (event.loaded / event.total) * 100;
                    progressBar.style.width = percent + '%';
                }
            };
            
            reader.onload = function(event) {
                progressBar.style.width = '100%';
                
                try {
                    const rawData = JSON.parse(event.target.result);
                    vocabData = [];
                    
                    // Ø¨Ø±Ø±Ø³ÛŒ Ùˆ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø§Ø² Ø³Ø§Ø®ØªØ§Ø±Ù‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù
                    if (Array.isArray(rawData)) {
                        vocabData = rawData;
                        fileStructure.type = 'array';
                    } else if (rawData.words && Array.isArray(rawData.words)) {
                        vocabData = rawData.words;
                        fileStructure.type = 'words_array';
                        fileStructure.metadata = rawData.metadata || rawData.info;
                    } else if (rawData.vocabulary && Array.isArray(rawData.vocabulary)) {
                        vocabData = rawData.vocabulary;
                        fileStructure.type = 'vocabulary_array';
                        fileStructure.metadata = rawData.metadata;
                    } else if (rawData.cards && Array.isArray(rawData.cards)) {
                        vocabData = rawData.cards;
                        fileStructure.type = 'cards_array';
                    } else if (rawData.data && Array.isArray(rawData.data)) {
                        vocabData = rawData.data;
                        fileStructure.type = 'data_array';
                    } else {
                        // Ø¨Ø±Ø±Ø³ÛŒ Ø¢ÛŒØ§ Ø¢Ø¨Ø¬Ú©Øª Ø­Ø§ÙˆÛŒ Ø¢Ø±Ø§ÛŒÙ‡â€ŒØ§ÛŒ Ø§Ø² Ù„ØºØ§Øª Ø§Ø³Øª
                        const keys = Object.keys(rawData);
                        for (const key of keys) {
                            if (Array.isArray(rawData[key]) && rawData[key].length > 0) {
                                const firstItem = rawData[key][0];
                                if (typeof firstItem === 'object' && (firstItem.word || firstItem.english || firstItem.text)) {
                                    vocabData = rawData[key];
                                    fileStructure.type = `dynamic_${key}_array`;
                                    break;
                                }
                            }
                        }
                    }
                    
                    if (vocabData.length === 0) {
                        throw new Error('Ø³Ø§Ø®ØªØ§Ø± JSON Ù†Ø§Ù…Ø¹ØªØ¨Ø± ÛŒØ§ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª');
                    }
                    
                    // Ø°Ø®ÛŒØ±Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³Ø§Ø®ØªØ§Ø±
                    fileStructure.totalItems = vocabData.length;
                    fileStructure.sampleItem = vocabData[0];
                    
                    document.getElementById('fileInfo').innerHTML = `
                        <i class="fas fa-check-circle"></i> ÙØ§ÛŒÙ„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯
                        <br><i class="fas fa-chart-bar"></i> ØªØ¹Ø¯Ø§Ø¯ Ù„ØºØ§Øª: <strong>${vocabData.length} Ù„ØºØª</strong>
                        <br><i class="fas fa-hdd"></i> Ø­Ø¬Ù… ÙØ§ÛŒÙ„: <strong>${(file.size / 1024).toFixed(1)} KB</strong>
                        <br><i class="fas fa-file-alt"></i> Ù†Ø§Ù… ÙØ§ÛŒÙ„: <strong>${file.name}</strong>
                        <br><i class="fas fa-project-diagram"></i> Ø³Ø§Ø®ØªØ§Ø±: <strong>${fileStructure.type}</strong>
                    `;
                    
                    showStatus(`âœ… ÙØ§ÛŒÙ„ vocab.json Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯ (${vocabData.length} Ù„ØºØª - Ù‡Ù…Ù‡ Ù„ØºØ§Øª ØªØ¨Ø¯ÛŒÙ„ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯)`, 'success');
                    
                    // Ù†Ù…Ø§ÛŒØ´ Ù†Ù…ÙˆÙ†Ù‡ Ø§Ø² Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
                    console.log('Ø³Ø§Ø®ØªØ§Ø± ÙØ§ÛŒÙ„:', fileStructure);
                    console.log('Ù†Ù…ÙˆÙ†Ù‡ Ù„ØºØ§Øª (Ûµ Ù…ÙˆØ±Ø¯ Ø§ÙˆÙ„):', vocabData.slice(0, 5));
                    
                } catch (error) {
                    showStatus(`âŒ Ø®Ø·Ø§ Ø¯Ø± Ø®ÙˆØ§Ù†Ø¯Ù† ÙØ§ÛŒÙ„ JSON: ${error.message}`, 'error');
                    console.error('Ø®Ø·Ø§ÛŒ Ù¾Ø§Ø±Ø³:', error);
                }
                
                setTimeout(() => {
                    progressBar.style.width = '0%';
                }, 1000);
            };
            
            reader.onerror = function() {
                showStatus('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø®ÙˆØ§Ù†Ø¯Ù† ÙØ§ÛŒÙ„', 'error');
            };
            
            showStatus('ğŸ“¥ Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ§ÛŒÙ„...', 'info');
            reader.readAsText(file);
        });
        
        // 2. ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ flashcards.json - ØªÙ…Ø§Ù… Ù„ØºØ§Øª
        function convertToFlashcards() {
            if (!vocabData.length) {
                showStatus('âŒ Ø§ÙˆÙ„ ÙØ§ÛŒÙ„ vocab.json Ø±Ùˆ Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†', 'error');
                return;
            }
            
            showStatus(`ğŸ”„ Ø¯Ø± Ø­Ø§Ù„ Ø³Ø§Ø®Øª flashcards.json Ø§Ø² ${vocabData.length} Ù„ØºØª...`, 'info');
            
            try {
                const flashcards = [];
                let skippedItems = 0;
                
                // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ALL Ù„ØºØ§Øª
                for (let i = 0; i < vocabData.length; i++) {
                    const word = vocabData[i];
                    if (!word) {
                        skippedItems++;
                        continue;
                    }
                    
                    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§ Ø§ÙˆÙ„ÙˆÛŒØªâ€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù
                    const wordText = getValue(word, ['word', 'english', 'text', 'term']);
                    if (!wordText) {
                        skippedItems++;
                        continue;
                    }
                    
                    const persianMeaning = getValue(word, [
                        'persian.main', 'persian.short', 'translation', 'farsi', 
                        'meanings[0].persian', 'meanings[0].english', 'definitions[0]'
                    ]);
                    
                    const phonetic = getValue(word, [
                        'phonetic.us', 'phonetic.uk', 'pronunciation', 'phonetic'
                    ]);
                    
                    const exampleData = getExampleData(word);
                    
                    flashcards.push({
                        id: `fc_${String(i + 1).padStart(4, '0')}`,
                        word: wordText,
                        phonetic: phonetic,
                        persianMeaning: persianMeaning || 'Ø¨Ø¯ÙˆÙ† ØªØ±Ø¬Ù…Ù‡',
                        example: exampleData.sentence || `This is "${wordText}" in a sentence.`,
                        exampleTranslation: exampleData.translation || `Ø§ÛŒÙ† ÛŒÚ© Ø¬Ù…Ù„Ù‡ Ø¨Ø±Ø§ÛŒ "${wordText}" Ø§Ø³Øª.`,
                        difficulty: mapDifficulty(getValue(word, ['level', 'difficulty', 'category'])),
                        partOfSpeech: getValue(word, ['partOfSpeech', 'pos', 'type']),
                        tags: extractTags(word),
                        timestamp: new Date().toISOString()
                    });
                }
                
                convertedFiles.flashcards = flashcards;
                createDownloadButton('flashcards.json', flashcards, 'flashcards');
                
                const successMessage = `âœ… flashcards.json Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯ (${flashcards.length} Ú©Ø§Ø±Øª)`;
                if (skippedItems > 0) {
                    showStatus(`${successMessage} - ${skippedItems} Ø¢ÛŒØªÙ… Ø±Ø¯ Ø´Ø¯`, 'success');
                } else {
                    showStatus(successMessage, 'success');
                }
                
                console.log('Ù†Ù…ÙˆÙ†Ù‡ ÙÙ„Ø´ Ú©Ø§Ø±Øª:', flashcards[0]);
                
            } catch (error) {
                showStatus(`âŒ Ø®Ø·Ø§ Ø¯Ø± Ø³Ø§Ø®Øª flashcards: ${error.message}`, 'error');
                console.error('Ø®Ø·Ø§ÛŒ Ú©Ø§Ù…Ù„:', error);
            }
        }
        
        // 3. ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ review.json - ØªÙ…Ø§Ù… Ù„ØºØ§Øª
        function convertToReview() {
            if (!vocabData.length) {
                showStatus('âŒ Ø§ÙˆÙ„ ÙØ§ÛŒÙ„ vocab.json Ø±Ùˆ Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†', 'error');
                return;
            }
            
            showStatus(`ğŸ”„ Ø¯Ø± Ø­Ø§Ù„ Ø³Ø§Ø®Øª review.json Ø§Ø² ${vocabData.length} Ù„ØºØª...`, 'info');
            
            try {
                const now = new Date();
                const isoDate = now.toISOString();
                const simpleDate = now.toISOString().split('T')[0];
                
                const reviewCards = [];
                let skippedItems = 0;
                
                // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ALL Ù„ØºØ§Øª
                for (let i = 0; i < vocabData.length; i++) {
                    const word = vocabData[i];
                    if (!word) {
                        skippedItems++;
                        continue;
                    }
                    
                    const wordText = getValue(word, ['word', 'english', 'text', 'term']);
                    if (!wordText) {
                        skippedItems++;
                        continue;
                    }
                    
                    const translation = getValue(word, [
                        'persian.main', 'persian.short', 'translation', 'farsi', 
                        'meanings[0].persian', 'meanings[0].english', 'definitions[0]'
                    ]);
                    
                    const phonetic = getValue(word, [
                        'phonetic.us', 'phonetic.uk', 'pronunciation', 'phonetic'
                    ]);
                    
                    const exampleData = getExampleData(word);
                    const level = getValue(word, ['level', 'difficulty', 'category']);
                    
                    const category = getCategory(level);
                    const difficulty = mapDifficultyPersian(level);
                    
                    const partOfSpeech = getValue(word, ['partOfSpeech', 'pos', 'type']);
                    
                    reviewCards.push({
                        id: `review_${String(i + 1).padStart(4, '0')}`,
                        word: wordText,
                        phonetic: phonetic,
                        translation: translation || 'Ø¨Ø¯ÙˆÙ† ØªØ±Ø¬Ù…Ù‡',
                        example: exampleData.sentence || `Example for ${wordText}`,
                        exampleTranslation: exampleData.translation || `Ù…Ø«Ø§Ù„ Ø¨Ø±Ø§ÛŒ ${wordText}`,
                        category: category,
                        difficulty: difficulty,
                        partOfSpeech: partOfSpeech,
                        audioUrl: getValue(word, ['audio.us', 'audio.uk', 'audio', 'sound']) || `audio/${wordText}.mp3`,
                        imageUrl: getValue(word, ['image', 'picture', 'photo']) || `images/${wordText}.jpg`,
                        tags: extractTags(word),
                        stats: {
                            views: 0,
                            correct: 0,
                            incorrect: 0,
                            lastSeen: null,
                            firstSeen: simpleDate,
                            successRate: 0
                        },
                        scheduling: {
                            box: 1,
                            isDue: true,
                            nextReview: getNextReviewDate(1),
                            interval: 1,
                            easeFactor: 2.5,
                            reviews: 0,
                            lapses: 0,
                            isNew: true,
                            isSuspended: false
                        },
                        metadata: {
                            source: "vocab.json",
                            timestamp: isoDate,
                            originalIndex: i,
                            wordLength: wordText.length,
                            hasExample: !!exampleData.sentence,
                            hasPhonetic: !!phonetic,
                            hasImage: !!getValue(word, ['image', 'picture', 'photo'])
                        }
                    });
                }
                
                // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¢Ù…Ø§Ø±
                const difficultyStats = {
                    Ø¢Ø³Ø§Ù†: reviewCards.filter(c => c.difficulty === 'Ø¢Ø³Ø§Ù†').length,
                    Ù…ØªÙˆØ³Ø·: reviewCards.filter(c => c.difficulty === 'Ù…ØªÙˆØ³Ø·').length,
                    Ø³Ø®Øª: reviewCards.filter(c => c.difficulty === 'Ø³Ø®Øª').length
                };
                
                const categoryStats = {};
                reviewCards.forEach(card => {
                    const cat = card.category;
                    categoryStats[cat] = (categoryStats[cat] || 0) + 1;
                });
                
                const reviewData = {
                    version: "4.0",
                    metadata: {
                        lessonId: "full_conversion",
                        lessonTitle: "ØªØ¨Ø¯ÛŒÙ„ Ú©Ø§Ù…Ù„ Ù„ØºØ§Øª",
                        createdAt: isoDate,
                        lastUpdated: isoDate,
                        author: "English7App Full Converter",
                        description: `ØªØ¨Ø¯ÛŒÙ„ Ú©Ø§Ù…Ù„ ${reviewCards.length} Ù„ØºØª Ø§Ø² vocab.json`,
                        totalCards: reviewCards.length,
                        originalCount: vocabData.length,
                        skippedItems: skippedItems,
                        difficultyDistribution: difficultyStats,
                        categoryDistribution: categoryStats,
                        partOfSpeechDistribution: getPartOfSpeechStats(reviewCards),
                        averageWordLength: calculateAverageWordLength(reviewCards),
                        recommendedDailyCards: calculateDailyCards(reviewCards.length),
                        estimatedStudyTime: Math.ceil(reviewCards.length * 1.2), // Ø¯Ù‚ÛŒÙ‚Ù‡
                        tags: ["ØªØ¨Ø¯ÛŒÙ„ Ú©Ø§Ù…Ù„", "Ù‡Ù…Ù‡ Ù„ØºØ§Øª", "Ù…Ø±ÙˆØ±", "ÙØ§Ø±Ø³ÛŒ"],
                        conversionInfo: {
                            timestamp: isoDate,
                            totalWords: vocabData.length,
                            convertedWords: reviewCards.length,
                            skippedWords: skippedItems,
                            conversionRate: ((reviewCards.length / vocabData.length) * 100).toFixed(1) + '%'
                        }
                    },
                    settings: {
                        newCardsPerDay: calculateDailyCards(reviewCards.length),
                        reviewCardsPerDay: Math.min(100, Math.floor(reviewCards.length / 10)),
                        maxReviewsPerDay: 200,
                        difficultySettings: {
                            again: 1.0,
                            hard: 1.2,
                            good: 1.5,
                            easy: 2.0
                        },
                        autoPlayAudio: true,
                        showExample: true,
                        showPhonetic: true,
                        showImage: true
                    },
                    cards: reviewCards,
                    progress: {
                        total: reviewCards.length,
                        new: reviewCards.length,
                        learning: 0,
                        review: 0,
                        mastered: 0,
                        streak: 0,
                        lastStudied: null,
                        totalStudyTime: 0,
                        averageScore: 0
                    }
                };
                
                convertedFiles.review = reviewData;
                createDownloadButton('review.json', reviewData, 'review');
                
                const successMessage = `âœ… review.json Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯ (${reviewCards.length} Ú©Ø§Ø±Øª Ø§Ø² ${vocabData.length} Ù„ØºØª)`;
                if (skippedItems > 0) {
                    showStatus(`${successMessage} - ${skippedItems} Ø¢ÛŒØªÙ… Ø±Ø¯ Ø´Ø¯`, 'success');
                } else {
                    showStatus(successMessage, 'success');
                }
                
                console.log('Ø¢Ù…Ø§Ø± ØªØ¨Ø¯ÛŒÙ„:', {
                    Ú©Ù„: vocabData.length,
                    ØªØ¨Ø¯ÛŒÙ„â€ŒØ´Ø¯Ù‡: reviewCards.length,
                    Ø±Ø¯â€ŒØ´Ø¯Ù‡: skippedItems,
                    Ù†Ø±Ø®: ((reviewCards.length / vocabData.length) * 100).toFixed(1) + '%'
                });
                console.log('Ù†Ù…ÙˆÙ†Ù‡ Ú©Ø§Ø±Øª Ù…Ø±ÙˆØ±:', reviewCards[0]);
                
            } catch (error) {
                showStatus(`âŒ Ø®Ø·Ø§ Ø¯Ø± Ø³Ø§Ø®Øª review: ${error.message}`, 'error');
                console.error('Ø®Ø·Ø§ÛŒ Ú©Ø§Ù…Ù„:', error);
            }
        }
        
        // 4. ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ games.json - ØªÙ…Ø§Ù… Ù„ØºØ§Øª
        function convertToGames() {
            if (!vocabData.length) {
                showStatus('âŒ Ø§ÙˆÙ„ ÙØ§ÛŒÙ„ vocab.json Ø±Ùˆ Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†', 'error');
                return;
            }
            
            showStatus(`ğŸ”„ Ø¯Ø± Ø­Ø§Ù„ Ø³Ø§Ø®Øª games.json Ø§Ø² ${vocabData.length} Ù„ØºØª...`, 'info');
            
            try {
                // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ALL Ù„ØºØ§Øª
                const allWords = vocabData;
                const wordCount = allWords.length;
                
                console.log(`Ø³Ø§Ø®Øª Ø¨Ø§Ø²ÛŒ Ø¨Ø±Ø§ÛŒ ${wordCount} Ù„ØºØª`);
                
                // 1. Ø¨Ø§Ø²ÛŒâ€ŒÙ‡Ø§ÛŒ Ø­Ø§ÙØ¸Ù‡ (Memory)
                const memoryGames = [];
                
                // ØªÙ‚Ø³ÛŒÙ… Ù„ØºØ§Øª Ø¨Ù‡ Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§ÛŒ 16 ØªØ§ÛŒÛŒ Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²ÛŒ Ø­Ø§ÙØ¸Ù‡
                const groups = [];
                for (let i = 0; i < wordCount; i += 16) {
                    const group = allWords.slice(i, i + 16);
                    if (group.length >= 6) { // Ø­Ø¯Ø§Ù‚Ù„ 6 Ù„ØºØª Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²ÛŒ
                        groups.push(group);
                    }
                }
                
                // Ø³Ø§Ø®Øª Ø¨Ø§Ø²ÛŒâ€ŒÙ‡Ø§ÛŒ Ø­Ø§ÙØ¸Ù‡
                groups.forEach((group, index) => {
                    const pairs = group.map(w => {
                        const wordText = getValue(w, ['word', 'english', 'text', 'term']);
                        const translation = getValue(w, [
                            'persian.main', 'persian.short', 'translation', 'farsi', 
                            'meanings[0].persian', 'meanings[0].english', 'definitions[0]'
                        ]);
                        
                        return {
                            en: wordText || '',
                            fa: translation || 'Ù…Ø¹Ù†ÛŒ',
                            hint: getValue(w, ['hint', 'tip', 'clue']) || '',
                            difficulty: mapDifficulty(getValue(w, ['level', 'difficulty']))
                        };
                    }).filter(p => p.en && p.fa && p.fa !== 'Ù…Ø¹Ù†ÛŒ');
                    
                    if (pairs.length >= 6) {
                        memoryGames.push({
                            id: `memory_${index + 1}`,
                            type: "memory",
                            title: `Ø­Ø§ÙØ¸Ù‡ Ù„ØºØ§Øª - Ù…Ø¬Ù…ÙˆØ¹Ù‡ ${index + 1}`,
                            description: `${pairs.length} Ø¬ÙØª Ù„ØºØª Ø¨Ø±Ø§ÛŒ ØªÙ…Ø±ÛŒÙ† Ø­Ø§ÙØ¸Ù‡`,
                            pairs: pairs,
                            difficulty: "medium",
                            timeLimit: 120,
                            maxMoves: pairs.length * 2
                        });
                    }
                });
                
                // 2. Ø¨Ø§Ø²ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ (Scramble)
                const scrambleGames = [];
                
                // ØªÙ‚Ø³ÛŒÙ… Ù„ØºØ§Øª Ø¨Ù‡ Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§ÛŒ 20 ØªØ§ÛŒÛŒ
                for (let i = 0; i < wordCount; i += 20) {
                    const group = allWords.slice(i, i + 20);
                    const items = group.map(w => {
                        const wordText = getValue(w, ['word', 'english', 'text', 'term']);
                        const translation = getValue(w, [
                            'persian.main', 'persian.short', 'translation', 'farsi'
                        ]);
                        
                        return {
                            word: (wordText || '').toLowerCase().replace(/\s/g, ''),
                            original: wordText || '',
                            hint: translation || 'Ù…Ø¹Ù†ÛŒ',
                            difficulty: mapDifficulty(getValue(w, ['level', 'difficulty'])),
                            length: wordText ? wordText.length : 0
                        };
                    }).filter(item => item.word && item.original && item.hint && item.hint !== 'Ù…Ø¹Ù†ÛŒ' && item.word.length >= 3);
                    
                    if (items.length >= 8) {
                        scrambleGames.push({
                            id: `scramble_${scrambleGames.length + 1}`,
                            type: "scramble",
                            title: `Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ Ø­Ø±ÙˆÙ - Ú¯Ø±ÙˆÙ‡ ${scrambleGames.length + 1}`,
                            description: `${items.length} Ú©Ù„Ù…Ù‡ Ø¨Ø±Ø§ÛŒ Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ`,
                            items: items,
                            difficulty: "medium",
                            timeLimit: 180,
                            maxAttempts: 3
                        });
                    }
                }
                
                // 3. Ø¨Ø§Ø²ÛŒ ØªØ·Ø¨ÛŒÙ‚ (Matching)
                const matchingGames = [];
                
                // Ø§ÛŒØ¬Ø§Ø¯ Ø¨Ø§Ø²ÛŒâ€ŒÙ‡Ø§ÛŒ ØªØ·Ø¨ÛŒÙ‚ Ø¨Ø±Ø§ÛŒ Ù„ØºØ§Øª Ø¨Ø§ Ù…Ø¹Ø§Ù†ÛŒ Ù…Ø´Ø§Ø¨Ù‡
                if (wordCount >= 15) {
                    for (let i = 0; i < Math.min(3, Math.floor(wordCount / 15)); i++) {
                        const startIdx = i * 15;
                        const endIdx = startIdx + 15;
                        const group = allWords.slice(startIdx, endIdx);
                        
                        const items = group.map(w => {
                            const wordText = getValue(w, ['word', 'english', 'text', 'term']);
                            const translation = getValue(w, [
                                'persian.main', 'persian.short', 'translation', 'farsi'
                            ]);
                            
                            return {
                                question: wordText || '',
                                answer: translation || 'Ù…Ø¹Ù†ÛŒ',
                                options: generateWrongOptions(allWords, translation)
                            };
                        }).filter(item => item.question && item.answer && item.answer !== 'Ù…Ø¹Ù†ÛŒ');
                        
                        if (items.length >= 10) {
                            matchingGames.push({
                                id: `match_${i + 1}`,
                                type: "matching",
                                title: `ØªØ·Ø¨ÛŒÙ‚ Ù„ØºØ§Øª - Ø³Ø±ÛŒ ${i + 1}`,
                                description: `${items.length} Ø³ÙˆØ§Ù„ ØªØ·Ø¨ÛŒÙ‚ÛŒ`,
                                items: items,
                                difficulty: "medium",
                                timePerQuestion: 30,
                                passScore: 70
                            });
                        }
                    }
                }
                
                // 4. Ø¨Ø§Ø²ÛŒ Ø­Ø§ÙØ¸Ù‡ Ø¬Ù…Ù„Ø§Øª
                const sentenceGames = [];
                const wordsWithExamples = allWords.filter(w => {
                    const example = getValue(w, ['meanings[0].example.sentence', 'examples[0].en', 'example']);
                    return example && example.length > 10;
                }).slice(0, 20); // Ø­Ø¯Ø§Ú©Ø«Ø± 20 Ø¬Ù…Ù„Ù‡
                
                if (wordsWithExamples.length >= 8) {
                    const sentencePairs = wordsWithExamples.map(w => {
                        const example = getValue(w, ['meanings[0].example.sentence', 'examples[0].en', 'example']);
                        const translation = getValue(w, [
                            'meanings[0].example.translation', 
                            'examples[0].fa', 
                            'translation'
                        ]);
                        
                        return {
                            en: example || '',
                            fa: translation || 'ØªØ±Ø¬Ù…Ù‡ Ø¬Ù…Ù„Ù‡',
                            word: getValue(w, ['word', 'english', 'text', 'term']) || ''
                        };
                    }).filter(p => p.en && p.fa && p.fa !== 'ØªØ±Ø¬Ù…Ù‡ Ø¬Ù…Ù„Ù‡');
                    
                    if (sentencePairs.length >= 8) {
                        sentenceGames.push({
                            id: "sentence_memory",
                            type: "memory",
                            title: "Ø­Ø§ÙØ¸Ù‡ Ø¬Ù…Ù„Ù‡â€ŒÙ‡Ø§",
                            description: "ØªØ·Ø¨ÛŒÙ‚ Ø¬Ù…Ù„Ø§Øª Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ Ùˆ ØªØ±Ø¬Ù…Ù‡ ÙØ§Ø±Ø³ÛŒ",
                            pairs: sentencePairs,
                            difficulty: "hard",
                            timeLimit: 150,
                            maxMoves: sentencePairs.length * 2
                        });
                    }
                }
                
                // ØªØ±Ú©ÛŒØ¨ Ù‡Ù…Ù‡ Ø¨Ø§Ø²ÛŒâ€ŒÙ‡Ø§
                let allGames = [...memoryGames, ...scrambleGames, ...matchingGames, ...sentenceGames];
                
                // Ø§Ú¯Ø± Ø¨Ø§Ø²ÛŒâ€ŒÙ‡Ø§ Ú©Ù… Ø¨ÙˆØ¯Ù†Ø¯ØŒ Ø¨Ø§Ø²ÛŒâ€ŒÙ‡Ø§ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†
                if (allGames.length < 4 && wordCount >= 20) {
                    const basicWords = allWords.slice(0, 20);
                    const basicPairs = basicWords.map(w => {
                        const wordText = getValue(w, ['word', 'english', 'text', 'term']);
                        const translation = getValue(w, ['persian.main', 'persian.short', 'translation', 'farsi']);
                        
                        return {
                            en: wordText || '',
                            fa: translation || 'Ù…Ø¹Ù†ÛŒ'
                        };
                    }).filter(p => p.en && p.fa && p.fa !== 'Ù…Ø¹Ù†ÛŒ').slice(0, 12);
                    
                    if (basicPairs.length >= 8) {
                        allGames.push({
                            id: "basic_memory",
                            type: "memory",
                            title: "Ø­Ø§ÙØ¸Ù‡ Ù„ØºØ§Øª Ù¾Ø§ÛŒÙ‡",
                            description: "Ù„ØºØ§Øª Ø§Ø¨ØªØ¯Ø§ÛŒÛŒ Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹",
                            pairs: basicPairs,
                            difficulty: "easy",
                            timeLimit: 90,
                            maxMoves: basicPairs.length * 2
                        });
                    }
                }
                
                // Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§Ø²ÛŒâ€ŒÙ‡Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø³Ø®ØªÛŒ
                const difficultyOrder = { "easy": 1, "medium": 2, "hard": 3 };
                allGames.sort((a, b) => difficultyOrder[a.difficulty] - difficultyOrder[b.difficulty]);
                
                const gamesData = {
                    metadata: {
                        totalGames: allGames.length,
                        totalWordsUsed: wordCount,
                        created: new Date().toISOString(),
                        gameTypes: [...new Set(allGames.map(g => g.type))],
                        difficultyLevels: [...new Set(allGames.map(g => g.difficulty))],
                        estimatedPlayTime: allGames.length * 5 + " Ø¯Ù‚ÛŒÙ‚Ù‡"
                    },
                    games: allGames
                };
                
                convertedFiles.games = gamesData;
                createDownloadButton('games.json', gamesData, 'games');
                
                const gameTypesCount = {
                    memory: allGames.filter(g => g.type === 'memory').length,
                    scramble: allGames.filter(g => g.type === 'scramble').length,
                    matching: allGames.filter(g => g.type === 'matching').length
                };
                
                showStatus(`âœ… games.json Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯ (${allGames.length} Ø¨Ø§Ø²ÛŒ Ø§Ø² ${wordCount} Ù„ØºØª)`, 'success');
                console.log('Ø¢Ù…Ø§Ø± Ø¨Ø§Ø²ÛŒâ€ŒÙ‡Ø§:', gameTypesCount);
                
            } catch (error) {
                showStatus(`âŒ Ø®Ø·Ø§ Ø¯Ø± Ø³Ø§Ø®Øª games: ${error.message}`, 'error');
                console.error('Ø®Ø·Ø§ÛŒ Ø³Ø§Ø®Øª games:', error);
            }
        }
        
        // 5. ØªØ¨Ø¯ÛŒÙ„ Ù‡Ù…Ù‡ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§
        function convertAll() {
            if (!vocabData.length) {
                showStatus('âŒ Ø§ÙˆÙ„ ÙØ§ÛŒÙ„ vocab.json Ø±Ùˆ Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†', 'error');
                return;
            }
            
            showStatus(`âš¡ Ø¯Ø± Ø­Ø§Ù„ ØªØ¨Ø¯ÛŒÙ„ Ù‡Ù…Ù‡ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø§Ø² ${vocabData.length} Ù„ØºØª...`, 'info');
            
            // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ
            document.getElementById('downloadButtons').innerHTML = '';
            document.getElementById('filesContainer').innerHTML = '';
            convertedFiles = {};
            
            // ØªØ¨Ø¯ÛŒÙ„ ØªØ±ØªÛŒØ¨ÛŒ Ø¨Ø§ ØªØ§Ø®ÛŒØ±
            setTimeout(() => {
                showStatus('ğŸ”„ Ù…Ø±Ø­Ù„Ù‡ Û±/Û³: Ø³Ø§Ø®Øª flashcards.json...', 'info');
                convertToFlashcards();
            }, 100);
            
            setTimeout(() => {
                showStatus('ğŸ”„ Ù…Ø±Ø­Ù„Ù‡ Û²/Û³: Ø³Ø§Ø®Øª review.json...', 'info');
                convertToReview();
            }, 800);
            
            setTimeout(() => {
                showStatus('ğŸ”„ Ù…Ø±Ø­Ù„Ù‡ Û³/Û³: Ø³Ø§Ø®Øª games.json...', 'info');
                convertToGames();
            }, 1500);
            
            setTimeout(() => {
                document.getElementById('fileList').style.display = 'block';
                updateFileList();
                showStatus(`ğŸ‰ Ù‡Ù…Ù‡ ${vocabData.length} Ù„ØºØª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ØªØ¨Ø¯ÛŒÙ„ Ø´Ø¯Ù†Ø¯!`, 'success');
                
                // Ù†Ù…Ø§ÛŒØ´ Ø®Ù„Ø§ØµÙ‡
                const summary = `
                    <div class="conversion-info">
                        <strong><i class="fas fa-chart-pie"></i> Ø®Ù„Ø§ØµÙ‡ ØªØ¨Ø¯ÛŒÙ„:</strong><br>
                        â€¢ Ú©Ù„ Ù„ØºØ§Øª ÙˆØ±ÙˆØ¯ÛŒ: ${vocabData.length}<br>
                        â€¢ flashcards.json: ${convertedFiles.flashcards?.items || 0} Ú©Ø§Ø±Øª<br>
                        â€¢ review.json: ${convertedFiles.review?.items || 0} Ú©Ø§Ø±Øª<br>
                        â€¢ games.json: ${convertedFiles.games?.items || 0} Ø¨Ø§Ø²ÛŒ<br>
                        â€¢ Ú©Ù„ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ ØªÙˆÙ„ÛŒØ¯ Ø´Ø¯Ù‡: ${(convertedFiles.flashcards?.items || 0) + (convertedFiles.review?.items || 0) + (convertedFiles.games?.items || 0)}
                    </div>
                `;
                
                const statusDiv = document.getElementById('status');
                statusDiv.innerHTML += summary;
                
            }, 2500);
        }
        
        // 6. ØªØ§Ø¨Ø¹ Ø¨Ø±Ø±Ø³ÛŒ Ø³Ø§Ø®ØªØ§Ø±
        function debugStructure() {
            if (!vocabData.length) {
                showStatus('âŒ Ø§ÙˆÙ„ ÙØ§ÛŒÙ„ vocab.json Ø±Ùˆ Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†', 'error');
                return;
            }
            
            console.log('=== Ø¨Ø±Ø±Ø³ÛŒ Ú©Ø§Ù…Ù„ Ø³Ø§Ø®ØªØ§Ø± vocab.json ===');
            console.log('ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§:', vocabData.length);
            console.log('Ù†ÙˆØ¹ Ø³Ø§Ø®ØªØ§Ø±:', fileStructure.type);
            
            // Ø¨Ø±Ø±Ø³ÛŒ Ûµ Ø¢ÛŒØªÙ… Ø§ÙˆÙ„
            console.log('\n=== Ûµ Ø¢ÛŒØªÙ… Ø§ÙˆÙ„ ===');
            for (let i = 0; i < Math.min(5, vocabData.length); i++) {
                console.log(`\nØ¢ÛŒØªÙ… ${i + 1}:`, vocabData[i]);
                console.log('Ú©Ù„ÛŒØ¯Ù‡Ø§:', Object.keys(vocabData[i]));
                
                // Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ ØªÙˆ Ø¯Ø± ØªÙˆ
                if (vocabData[i].meanings) {
                    console.log(`  meanings Ø³Ø§Ø®ØªØ§Ø±:`, vocabData[i].meanings[0]);
                }
                if (vocabData[i].persian) {
                    console.log(`  persian Ø³Ø§Ø®ØªØ§Ø±:`, vocabData[i].persian);
                }
                if (vocabData[i].phonetic) {
                    console.log(`  phonetic Ø³Ø§Ø®ØªØ§Ø±:`, vocabData[i].phonetic);
                }
            }
            
            // Ø¢Ù†Ø§Ù„ÛŒØ² Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ Ù…Ø´ØªØ±Ú©
            console.log('\n=== Ø¢Ù†Ø§Ù„ÛŒØ² Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ Ù…Ø´ØªØ±Ú© ===');
            const commonKeys = {};
            vocabData.slice(0, 20).forEach((item, index) => {
                Object.keys(item).forEach(key => {
                    commonKeys[key] = (commonKeys[key] || 0) + 1;
                });
            });
            
            console.log('ÙØ±Ø§ÙˆØ§Ù†ÛŒ Ú©Ù„ÛŒØ¯Ù‡Ø§ (Ø§Ø² Û²Û° Ø¢ÛŒØªÙ… Ø§ÙˆÙ„):', commonKeys);
            
            // Ù†Ù…Ø§ÛŒØ´ Ø¯Ø± ØµÙØ­Ù‡
            showStatus('ğŸ” Ø³Ø§Ø®ØªØ§Ø± Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¯Ø± Ú©Ù†Ø³ÙˆÙ„ Ù…Ø±ÙˆØ±Ú¯Ø± Ø¨Ø±Ø±Ø³ÛŒ Ø´Ø¯ (F12 Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯)', 'info');
            
            // Ø§ÛŒØ¬Ø§Ø¯ Ú¯Ø²Ø§Ø±Ø´ Ø³Ø§Ø®ØªØ§Ø±
            const structureReport = {
                totalItems: vocabData.length,
                structureType: fileStructure.type,
                sampleItemKeys: Object.keys(vocabData[0]),
                commonKeys: commonKeys,
                hasMeanings: vocabData[0].meanings ? 'âœ…' : 'âŒ',
                hasPersian: vocabData[0].persian ? 'âœ…' : 'âŒ',
                hasPhonetic: vocabData[0].phonetic ? 'âœ…' : 'âŒ',
                hasExamples: vocabData[0].examples || (vocabData[0].meanings && vocabData[0].meanings[0] && vocabData[0].meanings[0].example) ? 'âœ…' : 'âŒ'
            };
            
            console.log('Ú¯Ø²Ø§Ø±Ø´ Ø³Ø§Ø®ØªØ§Ø±:', structureReport);
        }
        
        // ========== ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ ==========
        
        // ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ù…Ù‚Ø¯Ø§Ø± Ø§Ø² Ù…Ø³ÛŒØ±Ù‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù
        function getValue(obj, paths) {
            if (!obj) return '';
            
            for (const path of paths) {
                if (path.includes('[') && path.includes(']')) {
                    // Ù…Ø³ÛŒØ±Ù‡Ø§ÛŒ Ø¢Ø±Ø§ÛŒÙ‡â€ŒØ§ÛŒ Ù…Ø§Ù†Ù†Ø¯ meanings[0].example
                    const parts = path.split(/\.|\[|\]/).filter(p => p);
                    let value = obj;
                    for (const part of parts) {
                        if (value === null || value === undefined) break;
                        if (part.match(/^\d+$/)) {
                            value = value[parseInt(part)];
                        } else {
                            value = value[part];
                        }
                    }
                    if (value) return value;
                } else {
                    // Ù…Ø³ÛŒØ±Ù‡Ø§ÛŒ Ø³Ø§Ø¯Ù‡
                    const parts = path.split('.');
                    let value = obj;
                    for (const part of parts) {
                        if (value === null || value === undefined) break;
                        value = value[part];
                    }
                    if (value) return value;
                }
            }
            return '';
        }
        
        // ØªØ§Ø¨Ø¹ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…Ø«Ø§Ù„
        function getExampleData(word) {
            let sentence = '';
            let translation = '';
            
            // Ø¨Ø±Ø±Ø³ÛŒ meanings[0].example
            if (word.meanings?.[0]?.example) {
                sentence = word.meanings[0].example.sentence || '';
                translation = word.meanings[0].example.translation || '';
            }
            
            // Ø¨Ø±Ø±Ø³ÛŒ examples[0]
            if (!sentence && word.examples?.[0]) {
                if (typeof word.examples[0] === 'string') {
                    sentence = word.examples[0];
                } else if (word.examples[0].en) {
                    sentence = word.examples[0].en;
                    translation = word.examples[0].fa || '';
                }
            }
            
            // Ø¨Ø±Ø±Ø³ÛŒ example Ù…Ø³ØªÙ‚ÛŒÙ…
            if (!sentence && word.example) {
                sentence = word.example;
            }
            
            return { sentence, translation };
        }
        
        // ØªØ§Ø¨Ø¹ Ø§Ø³ØªØ®Ø±Ø§Ø¬ ØªÚ¯â€ŒÙ‡Ø§
        function extractTags(word) {
            const tags = [];
            
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø³Ø·Ø­
            const level = getValue(word, ['level', 'difficulty', 'category']);
            if (level) tags.push(level);
            
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† part of speech
            const pos = getValue(word, ['partOfSpeech', 'pos', 'type']);
            if (pos) tags.push(pos);
            
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù…ÙˆØ¶ÙˆØ¹
            const topic = getValue(word, ['topic', 'theme', 'subject']);
            if (topic) tags.push(topic);
            
            // ØªÚ¯â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶
            tags.push('ØªØ¨Ø¯ÛŒÙ„ Ú©Ø§Ù…Ù„', 'Ù‡Ù…Ù‡ Ù„ØºØ§Øª');
            
            return [...new Set(tags.filter(t => t))]; // Ø­Ø°Ù ØªÚ©Ø±Ø§Ø±ÛŒâ€ŒÙ‡Ø§
        }
        
        // ØªØ§Ø¨Ø¹ ØªÙˆÙ„ÛŒØ¯ Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ ØºÙ„Ø· Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²ÛŒ ØªØ·Ø¨ÛŒÙ‚
        function generateWrongOptions(allWords, correctAnswer) {
            const options = [correctAnswer];
            const usedTranslations = new Set([correctAnswer]);
            
            // Ø§Ù†ØªØ®Ø§Ø¨ Û³ ØªØ±Ø¬Ù…Ù‡ ØªØµØ§Ø¯ÙÛŒ Ø¯ÛŒÚ¯Ø±
            for (let i = 0; i < 3; i++) {
                let randomWord;
                let randomTranslation;
                let attempts = 0;
                
                do {
                    randomWord = allWords[Math.floor(Math.random() * allWords.length)];
                    randomTranslation = getValue(randomWord, [
                        'persian.main', 'persian.short', 'translation', 'farsi'
                    ]);
                    attempts++;
                } while ((!randomTranslation || usedTranslations.has(randomTranslation) || randomTranslation === correctAnswer) && attempts < 10);
                
                if (randomTranslation && !usedTranslations.has(randomTranslation)) {
                    options.push(randomTranslation);
                    usedTranslations.add(randomTranslation);
                }
            }
            
            // Ø§Ú¯Ø± Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ Ú©Ù… Ø¨ÙˆØ¯Ù†Ø¯ØŒ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†
            while (options.length < 4) {
                options.push(`Ú¯Ø²ÛŒÙ†Ù‡ ${options.length + 1}`);
            }
            
            // Ù…Ø®Ù„ÙˆØ· Ú©Ø±Ø¯Ù† Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§
            return shuffleArray([...options]);
        }
        
        // ØªØ§Ø¨Ø¹ Ù…Ø®Ù„ÙˆØ· Ú©Ø±Ø¯Ù† Ø¢Ø±Ø§ÛŒÙ‡
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }
        
        // Ø¢Ù…Ø§Ø± part of speech
        function getPartOfSpeechStats(cards) {
            const stats = {};
            cards.forEach(card => {
                const pos = card.partOfSpeech || 'unknown';
                stats[pos] = (stats[pos] || 0) + 1;
            });
            return stats;
        }
        
        // Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø·ÙˆÙ„ Ú©Ù„Ù…Ø§Øª
        function calculateAverageWordLength(cards) {
            const total = cards.reduce((sum, card) => sum + (card.word?.length || 0), 0);
            return cards.length > 0 ? (total / cards.length).toFixed(1) : 0;
        }
        
        // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø±ÙˆØ²Ø§Ù†Ù‡
        function calculateDailyCards(totalCards) {
            if (totalCards <= 50) return 10;
            if (totalCards <= 100) return 15;
            if (totalCards <= 200) return 20;
            if (totalCards <= 500) return 25;
            return 30;
        }
        
        // ========== ØªÙˆØ§Ø¨Ø¹ Ù¾Ø§ÛŒÙ‡ ==========
        
        function mapDifficulty(level) {
            if (!level) return 'easy';
            level = String(level).toUpperCase();
            if (level.includes('B') || level.includes('2') || level.includes('Ù…ØªÙˆØ³Ø·')) return 'medium';
            if (level.includes('C') || level.includes('3') || level.includes('Ø³Ø®Øª') || level.includes('Ù¾ÛŒØ´Ø±ÙØªÙ‡')) return 'hard';
            return 'easy';
        }
        
        function mapDifficultyPersian(level) {
            if (!level) return 'Ø¢Ø³Ø§Ù†';
            level = String(level).toUpperCase();
            if (level.includes('B') || level.includes('2') || level.includes('MEDIUM') || level.includes('Ù…ØªÙˆØ³Ø·')) return 'Ù…ØªÙˆØ³Ø·';
            if (level.includes('C') || level.includes('3') || level.includes('HARD') || level.includes('Ø³Ø®Øª') || level.includes('Ù¾ÛŒØ´Ø±ÙØªÙ‡')) return 'Ø³Ø®Øª';
            return 'Ø¢Ø³Ø§Ù†';
        }
        
        function getCategory(level) {
            if (!level) return 'Ù¾Ø§ÛŒÙ‡';
            level = String(level).toUpperCase();
            if (level.includes('A') || level.includes('1') || level.includes('BASIC') || level.includes('Ù¾Ø§ÛŒÙ‡')) return 'Ù¾Ø§ÛŒÙ‡';
            if (level.includes('B') || level.includes('2') || level.includes('INTERMEDIATE') || level.includes('Ù…ØªÙˆØ³Ø·')) return 'Ù…ØªÙˆØ³Ø·';
            if (level.includes('C') || level.includes('3') || level.includes('ADVANCED') || level.includes('Ù¾ÛŒØ´Ø±ÙØªÙ‡')) return 'Ù¾ÛŒØ´Ø±ÙØªÙ‡';
            return 'Ù¾Ø§ÛŒÙ‡';
        }
        
        function getNextReviewDate(box) {
            const date = new Date();
            date.setDate(date.getDate() + box);
            return date.toISOString().split('T')[0];
        }
        
        function createDownloadButton(filename, data, type) {
            // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡ Ù‚Ø¨Ù„ÛŒ Ø¨Ø§ Ù‡Ù…ÛŒÙ† Ù†Ø§Ù…
            const existingBtn = document.querySelector(`[data-filename="${filename}"]`);
            if (existingBtn) existingBtn.remove();
            
            const jsonStr = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const btn = document.createElement('button');
            btn.className = 'btn btn-download';
            btn.setAttribute('data-filename', filename);
            btn.innerHTML = `<i class="fas fa-download"></i> Ø¯Ø§Ù†Ù„ÙˆØ¯ ${filename}`;
            btn.onclick = () => {
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                
                setTimeout(() => URL.revokeObjectURL(url), 100);
            };
            
            document.getElementById('downloadButtons').appendChild(btn);
            
            // Ø°Ø®ÛŒØ±Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª
            convertedFiles[type] = {
                filename: filename,
                data: data,
                size: (jsonStr.length / 1024).toFixed(1) + ' KB',
                items: Array.isArray(data) ? data.length : 
                       data.games ? data.games.length : 
                       data.cards ? data.cards.length : 0,
                timestamp: new Date().toISOString()
            };
            
            updateFileList();
        }
        
        function updateFileList() {
            const container = document.getElementById('filesContainer');
            container.innerHTML = '';
            
            const files = [
                { key: 'flashcards', name: 'flashcards.json', icon: 'fa-layer-group', color: '#4CAF50' },
                { key: 'review', name: 'review.json', icon: 'fa-history', color: '#2196F3' },
                { key: 'games', name: 'games.json', icon: 'fa-gamepad', color: '#FF9800' }
            ];
            
            files.forEach(file => {
                if (convertedFiles[file.key]) {
                    const info = convertedFiles[file.key];
                    const div = document.createElement('div');
                    div.className = 'file-item';
                    div.innerHTML = `
                        <div class="file-info">
                            <i class="fas ${file.icon}" style="color: ${file.color}"></i> 
                            <strong>${file.name}</strong>
                            <span class="counter">${info.items} Ø¢ÛŒØªÙ…</span>
                            <br>
                            <small>
                                <i class="fas fa-hdd"></i> ${info.size} | 
                                <i class="fas fa-clock"></i> ${new Date(info.timestamp).toLocaleTimeString('fa-IR')}
                            </small>
                        </div>
                        <div class="file-actions">
                            <button onclick="previewFile('${file.key}')" style="background: ${file.color}; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    `;
                    container.appendChild(div);
                }
            });
            
            if (container.children.length > 0) {
                document.getElementById('fileList').style.display = 'block';
            }
        }
        
        // ØªØ§Ø¨Ø¹ Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ ÙØ§ÛŒÙ„
        function previewFile(type) {
            if (convertedFiles[type]) {
                console.log(`Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ ${type}:`, convertedFiles[type].data);
                alert(`Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ ${convertedFiles[type].filename} Ø¯Ø± Ú©Ù†Ø³ÙˆÙ„ Ù…Ø±ÙˆØ±Ú¯Ø± Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯ (F12)`);
            }
        }
        
        function showStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<i class="fas fa-info-circle"></i> ${message}`;
            statusDiv.className = `status ${type}`;
            statusDiv.style.display = 'block';
            
            if (type === 'error') {
                console.error('Status Error:', message);
            }
            
            setTimeout(() => {
                if (statusDiv.innerHTML.includes(message)) {
                    statusDiv.style.opacity = '0.7';
                }
            }, 5000);
        }
        
        // Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
        showStatus('ğŸ“ Ù„Ø·ÙØ§ ÙØ§ÛŒÙ„ vocab.json Ø±Ø§ Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†ÛŒØ¯ - Ù‡Ù…Ù‡ Ù„ØºØ§Øª Ø¨Ø¯ÙˆÙ† Ù…Ø­Ø¯ÙˆØ¯ÛŒØª ØªØ¨Ø¯ÛŒÙ„ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯', 'info');
    </script>
</body>
</html>